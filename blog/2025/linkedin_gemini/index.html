<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, shrink-to-fit=no"
/>


<title>Automate LinkedIn Carousels with R and Gemini - Dr. Mowinckel&#39;s</title>


<meta name="hugo-igloo" />




  <meta name="description" content="Learn how to automate LinkedIn carousel creation with R and the free Gemini API. This post details a complete workflow, from connecting to the API and summarizing a blog post into structured points, to generating a custom Quarto document ready for manual review and posting." />
  <meta name="author" content="Dr. Mowinckel" />






<meta name="generator" content="Hugo 0.138.0">



        


<meta prefix="og: http://ogp.me/ns#" property="og:description" content="Automate LinkedIn carousels with R and Gemini. Use the free API to summarize blog posts and generate professional, engaging content.">


<meta prefix="og: http://ogp.me/ns#" property="og:url" content="https://drmowinckels.io/blog/2025/linkedin_gemini/">
<meta prefix="og: http://ogp.me/ns#" property="og:type" content="website">
<meta prefix="og: http://ogp.me/ns#" property="og:title" content="Automate LinkedIn Carousels with R and Gemini - Dr. Mowinckel&rsquo;s">
<meta prefix="og: http://ogp.me/ns#" property="og:description" content="Automate LinkedIn carousels with R and Gemini. Use the free API to summarize blog posts and generate professional, engaging content.">


<meta name="twitter:card" content="summary_large_image">
<meta property="twitter:domain" content="https://drmowinckels.io/blog/2025/linkedin_gemini/">
<meta name="twitter:title" content="Igloo">
<meta name="twitter:description" content="Automate LinkedIn carousels with R and Gemini. Use the free API to summarize blog posts and generate professional, engaging content.">



    <meta prefix="og: http://ogp.me/ns#" property="og:image" content="https://drmowinckels.io/blog/2025/linkedin_gemini/r_gemini_carousel.png" />
    <meta name="twitter:image" content="https://drmowinckels.io/blog/2025/linkedin_gemini/r_gemini_carousel.png">



        
  





    



 

    <link rel="stylesheet" href="https://drmowinckels.io/bundle.min.baa1908f96e0c6f9b71447b145d29e168c7a152baf3ed19c88d9c64d40abd901.css" 
    integrity="sha256-uqGQj5bgxvm3FEexRdKeFox6FSuvPtGciNnGTUCr2QE=" 
    crossorigin="anonymous">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" crossorigin="anonymous">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha384-k6Rqe5g0pSv8V0e6fFfFjW1y77vKTjkE1IUaB+MHUO2GtODX6azbMqa6Y53/zJTU" crossorigin="anonymous">

        
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/night-owl.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>



    <script src="https://drmowinckels.io/uikit/dist/js/uikit.min.js"></script>


    <script src="https://drmowinckels.io/uikit/dist/js/uikit-icons.min.js"></script>



    <script async data-id="101481527" src="//static.getclicky.com/js"></script>


        



    

    
    
    
    <link
        rel="icon"
        href="https://drmowinckels.io/img/fav.ico_hu5366878624836852736.png"
        sizes="16x16"
        type="image/png"
    />
    
    
    
        
        <link rel="shortcut icon" href="https://drmowinckels.io/favicon.ico" type="image/x-icon">
    
    <link
        rel="icon"
        href="https://drmowinckels.io/img/fav.ico_hu8517673850517275173.png"
        sizes="32x32"
        type="image/png"
    />
    
    
    
    <link
        rel="icon"
        href="https://drmowinckels.io/img/fav.ico_hu14571942087844283845.png"
        sizes="57x57"
        type="image/png"
    />
    
    
    
    <link
        rel="icon"
        href="https://drmowinckels.io/img/fav.ico_hu15407313826671950185.png"
        sizes="76x76"
        type="image/png"
    />
    
    
    
    <link
        rel="icon"
        href="https://drmowinckels.io/img/fav.ico_hu5243028335169998791.png"
        sizes="96x96"
        type="image/png"
    />
    
    
    
    <link
        rel="icon"
        href="https://drmowinckels.io/img/fav.ico_hu12542686187326557868.png"
        sizes="128x128"
        type="image/png"
    />
    
    
    
    <link
        rel="apple-touch-icon"
        href="https://drmowinckels.io/img/fav.ico_hu13659698330348218391.png"
        sizes="120x120"
        type="image/png"
    />
    
    
    
    <link
        rel="icon"
        href="https://drmowinckels.io/img/fav.ico_hu16981009452699216388.png"
        sizes="150x150"
        type="image/png"
    />
    
    
    
    <link
        rel="apple-touch-icon"
        href="https://drmowinckels.io/img/fav.ico_hu7549612530560663352.png"
        sizes="152x152"
        type="image/png"
    />
    
    
    
        <meta name="msapplication-TileImage" 
            content="/img/fav.ico_hu4123736746700774209.png">
    
    <link
        rel="icon"
        href="https://drmowinckels.io/img/fav.ico_hu4123736746700774209.png"
        sizes="144x144"
        type="image/png"
    />
    
    
    
    <link
        rel="apple-touch-icon"
        href="https://drmowinckels.io/img/fav.ico_hu15595176060954391820.png"
        sizes="180x180"
        type="image/png"
    />
    
    
    
    <link
        rel="icon"
        href="https://drmowinckels.io/img/fav.ico_hu15967068578190144734.png"
        sizes="192x192"
        type="image/png"
    />
    
    
    
    <link
        rel="shortcut icon"
        href="https://drmowinckels.io/img/fav.ico_hu7854817480044023005.png"
        sizes="196x196"
        type="image/png"
    />
<meta name="msapplication-TileColor" content="#198c8c">
<meta name="theme-color" content="#198c8c"> 
<meta name="msapplication-TileColor" content="#198c8c">

    </head>
    <body>
            
<div class="banner ">
    
        <div class="uk-container uk-container-small banner-top">
            <h1>blog</h1>
        </div>
    
</div>

        



<div id="smallnav" uk-offcanvas="flip: true" class="uk-offcanvas">
    <div class="uk-offcanvas-bar">
        <ul class="uk-nav">
            
                <a class="uk-navbar-item uk-logo" href="https://drmowinckels.io/">
                    <img src="https://drmowinckels.io/img/logo.png" width="40">
                </a> 
            
            
                <li>
                    <a href="https://drmowinckels.io/about">
                        About
                        
                    </a>
                    
                </li>
            
                <li>
                    <a href="https://drmowinckels.io/blog">
                        Blog
                        
                    </a>
                    
                </li>
            
                <li>
                    <a href="https://drmowinckels.io/talks">
                        Talks
                        
                    </a>
                    
                </li>
            
                <li>
                    <a href="https://drmowinckels.io/projects">
                        Projects
                        
                    </a>
                    
                </li>
            
        </ul>
    </div>
</div>
<a class="uk-navbar-container uk-navbar-left uk-navbar-toggle uk-hidden@s" uk-toggle="target: #smallnav" uk-navbar-toggle-icon></a>

<div class="uk-visible@s" uk-sticky="sel-target: .uk-navbar-container; cls-active: uk-navbar-sticky">
    <nav class="uk-navbar-container">   
        <div uk-navbar>     
            <div class="uk-navbar-center">
                
                    
                        <div class="uk-navbar-center-left">
                            <ul class="uk-navbar-nav">
                    
                    
                    <li>
                        <a href="https://drmowinckels.io/about">
                            About
                            
                        </a>
                        
                    </li>
                    
                
                    
                    
                    <li>
                        <a href="https://drmowinckels.io/blog">
                            Blog
                            
                        </a>
                        
                    </li>
                    
                            </ul>
                        </div>
                    
                
                    
                    
                        
                            <a class="uk-navbar-item uk-logo" href="https://drmowinckels.io/">
                                <img src="https://drmowinckels.io/img/logo.png" width="40">
                            </a> 
                        
                        <div class="uk-navbar-center-right">
                            <ul class="uk-navbar-nav"> 
                    
                    <li>
                        <a href="https://drmowinckels.io/talks">
                            Talks
                            
                        </a>
                        
                    </li>
                    
                
                    
                    
                    <li>
                        <a href="https://drmowinckels.io/projects">
                            Projects
                            
                        </a>
                        
                    </li>
                    
                            </ul>
                        </div>
                    
                
            </div>
        </div>
    </nav>
</div>


        <div id="content" class="uk-container uk-container-small uk-margin-large-top">
    <article class="uk-article">
        <div class="uk-grid uk-flex-top" uk-grid>
            
            
            <div class="uk-width-1-4@s">
              <img src="https://drmowinckels.io/blog/2025/linkedin_gemini/r_gemini_carousel.png" alt="A whimsical, anime-style drawing of anthropomorphized R-logo and Gemini logo characters riding a merry-go-round. The R-logo character, a blue and gray figure, is on a carousel alpaca, while the Gemini logo character, a colorful star-shaped figure, is on a unicorn. They are both smiling and appear to be having fun.
" class="uk-border-rounded">
              
            </div>

        <div class="uk-width-3-4@s">
        <h1 class="uk-article-title">Automate LinkedIn Carousels with R and Gemini</h1>
        
        <div class="uk-border-top uk-article-meta uk-flex uk-flex-center uk-flex-between">
            <h3 class="uk-margin-top-small">
                Aug 1, 2025
            </h3>
            

            
                <div class="uk-flex uk-flex-wrap uk-flex-right">
                    
                        
                        
                        
                        
                        
                        <div class="uk-card uk-margin-left uk-margin-bottom">
                            <a href="https://drmowinckels.io/tags/r/" class="uk-label uk-label-secondary tags" >
                                R
                            </a>
                        </div>
                    
                        
                        
                        
                        
                        
                        <div class="uk-card uk-margin-left uk-margin-bottom">
                            <a href="https://drmowinckels.io/tags/api/" class="uk-label uk-label-secondary tags" >
                                API
                            </a>
                        </div>
                    
                </div>
            
        </div>
    </div>
        <div id="offcanvas-reveal" uk-offcanvas="mode: reveal; overlay: true">
            <div class="uk-offcanvas-bar">
                <button class="uk-offcanvas-close" type="button" uk-close></button>
                <h3>Table of Content</h3>
                <nav id="TableOfContents">
  <ul>
    <li><a href="#creating-summaries">Creating summaries</a></li>
    <li><a href="#connecting-to-gemini-through-r">Connecting to Gemini through R</a>
      <ul>
        <li><a href="#step-1-getting-the-upload-url">Step 1: Getting the upload URL</a></li>
        <li><a href="#step-2-uploading-the-file-content">Step 2: Uploading the file content</a></li>
        <li><a href="#combining-the-steps-into-a-function">Combining the steps into a function</a></li>
        <li><a href="#step-3-generating-the-content">Step 3: Generating the content</a></li>
      </ul>
    </li>
    <li><a href="#creating-a-suitable-prompt">Creating a suitable prompt</a></li>
    <li><a href="#creating-a-quarto-document-for-the-carousel">Creating a Quarto document for the carousel</a></li>
    <li><a href="#the-orchestration-function">The Orchestration Function</a></li>
    <li><a href="#what-about-the-linkedin-post">What about the LinkedIn post?</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
            </div>
        </div>
        
            <p class="uk-text-lead">Learn how to automate LinkedIn carousel creation with R and the free Gemini API. This post details a complete workflow, from connecting to the API and summarizing a blog post into structured points, to generating a custom Quarto document ready for manual review and posting.</p>
        
        <div class="uk-markdown uk-width">
            <p>If you are on LinkedIn, you may have seen the carousel posts that allow you to share multiple images in a single post.
These carousels are a great way to showcase your work, share insights, or tell a story.
Creating engaging LinkedIn carousels can be time-consuming.
What if you could automate the process using R and a powerful AI?
I wanted to explore how to create these carousels from R, that would summarise the content of a blog post.</p>
<h2 id="creating-summaries">Creating summaries</h2>
<p>To summarize the content, I chose to leverage the power of a large language model (LLM).
As always, I&rsquo;d like to keep things free, so I opted to using Google&rsquo;s <a href="https://gemini.google.com/app">Gemini</a>, which would allow me to use the free tier of the API.</p>
<p>I&rsquo;ve already tested Gemini in the browser for smaller tasks, and thought it did a decent job in summarising content.
I also know it is used in the background for the <a href="https://cosimameyer.com/post/2023-04-25-building-mastodon-bots-and-promoting-the-community/">R-Ladies bot</a>.
So I set out to create a function that would summarise the content of a markdown file into a series of points suitable for a LinkedIn carousel.</p>
<p>I had planned to use the <a href="https://github.com/jhk0530/gemini.R"><code>gemini.R</code></a> package, which provides a convenient interface to the Gemini API.
This package allows you to send prompts to the Gemini model and receive responses in a structured format.
Since I plan on using this function to summarise a blog post, which is typically in Markdown format, I decided to use the <code>gemini_docs()</code> function from the package.
This conveniently takes a file path, file type and a prompt, and returns the response from the Gemini model.
However, the current version was failing to return a response, so I decided to create my own function.
Once I have a working function, I will consider submitting a PR to the package to include it.</p>
<h2 id="connecting-to-gemini-through-r">Connecting to Gemini through R</h2>
<p>To connect to the Gemini API, you need to <a href="https://developers.google.com/workspace/guides/create-project">set up a project in the Google Cloud Console</a>, <a href="https://console.cloud.google.com/apis/library/generativelanguage.googleapis.com">enable the Gemini API</a>, and obtain an API key from <a href="https://aistudio.google.com/">Google AI Studio</a>.
From here, we can start playing with the API.</p>
<p>One of the simplest examples in AI Studio is this curl snippet:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl <span style="color:#e6db74">&#39;https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -H <span style="color:#e6db74">&#39;Content-Type: application/json&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -H <span style="color:#e6db74">&#39;X-goog-api-key: GEMINI_API_KEY&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -X POST <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -d <span style="color:#e6db74">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;contents&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;parts&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;text&#34;: &#34;Explain how AI works in a few words&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }&#39;</span>
</span></span></code></pre></div><p>To use this in R, we can use the <code>httr2</code> package to make the API call.
As mentioned in my <a href="./blog/2025/httr2_client/">previous post</a>, httr2 also has a nice function <a href="https://httr2.r-lib.org/reference/curl_translate.html"><code>curl_translate()</code></a> for translating curl commands to an httr2 command chain.
We will use that here to create a test call to the API.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(httr2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">curl_translate</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;</span><span style="color:#960050;background-color:#1e0010">curl &#39;https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent&#39; \</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">-</span>H <span style="color:#e6db74">&#39;Content-Type: application/json&#39;</span> \
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">-</span>H <span style="color:#e6db74">&#39;X-goog-api-key: GEMINI_API_KEY&#39;</span> \
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">-</span>X POST \
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">-</span>d <span style="color:#e6db74">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    \&#34;contents\&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        \&#34;parts\&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            \&#34;text\&#34;: \&#34;Explain how AI works in a few words\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><pre><code>request(&quot;https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent&quot;) |&gt;
  req_method(&quot;POST&quot;) |&gt;
  req_headers(
    `X-goog-api-key` = &quot;GEMINI_API_KEY&quot;,
  ) |&gt;
  req_body_json(
    data = list(contents = list(list(parts = list(list(text = &quot;Explain how AI works in a few words&quot;))))),
  ) |&gt;
  req_perform()
</code></pre>
<p>Now that we have the translated curl command in httr2, we can use it to make the API call.
First, we need to replace the <code>GEMINI_API_KEY</code> with our actual API key.
I will place my API key in a <code>.Renviron</code> file, so I can access it using <code>Sys.getenv(&quot;GEMINI_API_KEY&quot;)</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>resp <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">request</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent&#34;</span>
</span></span><span style="display:flex;"><span>) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">req_method</span>(<span style="color:#e6db74">&#34;POST&#34;</span>) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">req_headers</span>(
</span></span><span style="display:flex;"><span>    `X-goog-api-key` <span style="color:#f92672">=</span> <span style="color:#a6e22e">Sys.getenv</span>(<span style="color:#e6db74">&#34;GEMINI_API_KEY&#34;</span>),
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">req_body_json</span>(
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(
</span></span><span style="display:flex;"><span>      contents <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(<span style="color:#a6e22e">list</span>(
</span></span><span style="display:flex;"><span>        parts <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(<span style="color:#a6e22e">list</span>(text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Explain how AI works in a few words&#34;</span>))
</span></span><span style="display:flex;"><span>      ))
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">req_perform</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">resp_body_json</span>(resp)
</span></span></code></pre></div><pre><code>$candidates
$candidates[[1]]
$candidates[[1]]$content
$candidates[[1]]$content$parts
$candidates[[1]]$content$parts[[1]]
$candidates[[1]]$content$parts[[1]]$text
[1] &quot;AI learns from data to make decisions or predictions.\n&quot;



$candidates[[1]]$content$role
[1] &quot;model&quot;


$candidates[[1]]$finishReason
[1] &quot;STOP&quot;

$candidates[[1]]$avgLogprobs
[1] -0.09323899



$usageMetadata
$usageMetadata$promptTokenCount
[1] 8

$usageMetadata$candidatesTokenCount
[1] 11

$usageMetadata$totalTokenCount
[1] 19

$usageMetadata$promptTokensDetails
$usageMetadata$promptTokensDetails[[1]]
$usageMetadata$promptTokensDetails[[1]]$modality
[1] &quot;TEXT&quot;

$usageMetadata$promptTokensDetails[[1]]$tokenCount
[1] 8



$usageMetadata$candidatesTokensDetails
$usageMetadata$candidatesTokensDetails[[1]]
$usageMetadata$candidatesTokensDetails[[1]]$modality
[1] &quot;TEXT&quot;

$usageMetadata$candidatesTokensDetails[[1]]$tokenCount
[1] 11




$modelVersion
[1] &quot;gemini-2.0-flash&quot;

$responseId
[1] &quot;w_OLaIufN7O71PIP2dSJ8QU&quot;
</code></pre>
<p>We have lift-off!
The response from the API is a JSON object containing the generated content, and some more meta-data regarding the model and the request.
Now that we have a working API call, we can start building our function to summarise the content of a blog post.</p>
<p>Looking at the documentation for the <code>generateContent</code> endpoint, we can see that it takes a list of contents, each containing a list of parts.
Each part can contain text, images, or other media.
We will use the <code>text</code> part to generate the summary of the blog post, and the <code>file_data</code> to include the entire blog post content.
This approach requires three steps:</p>
<ol>
<li>get a uri from the API to upload the file,</li>
<li>upload the file to the uri,</li>
<li>call the <code>generateContent</code> endpoint with the file uri and the prompt.</li>
</ol>
<p>Because step1 has a different URL than step 3, I first created a function to generate the gemini url for each endpoint.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>gemini_url <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(
</span></span><span style="display:flex;"><span>  version <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;v1beta&#34;</span>,
</span></span><span style="display:flex;"><span>  model <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;gemini-1.5-flash&#34;</span>,
</span></span><span style="display:flex;"><span>  upload <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>
</span></span><span style="display:flex;"><span>) {
</span></span><span style="display:flex;"><span>  baseurl <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;https://generativelanguage.googleapis.com&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (upload) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span>(<span style="color:#a6e22e">file.path</span>(
</span></span><span style="display:flex;"><span>      baseurl,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;upload&#34;</span>,
</span></span><span style="display:flex;"><span>      version,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;files&#34;</span>
</span></span><span style="display:flex;"><span>    ))
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">sprintf</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;%s/%s/models/%s:generateContent&#34;</span>,
</span></span><span style="display:flex;"><span>    baseurl,
</span></span><span style="display:flex;"><span>    version,
</span></span><span style="display:flex;"><span>    model
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gemini_url</span>()
</span></span></code></pre></div><pre><code>[1] &quot;https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent&quot;
</code></pre>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">gemini_url</span>(upload <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</span></span></code></pre></div><pre><code>[1] &quot;https://generativelanguage.googleapis.com/upload/v1beta/files&quot;
</code></pre>
<p>With this function, we can easily switch between the two endpoints, and even update the API version or model if needed.
I thought this would give me the most flexibility in the future.</p>
<p>Next, I needed a function to upload the file to the Gemini API, which will cover both step 1 and 2.</p>
<h3 id="step-1-getting-the-upload-url">Step 1: Getting the upload URL</h3>
<p>To upload a file to the Gemini API, we first need to get an upload URL.
You can do this by making a request to the <code>upload</code> endpoint with the appropriate headers and body.
It&rsquo;s basically giving the API a heads up that we want to upload a file, and it will return an upload URL in the response header.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>api_key <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">Sys.getenv</span>(<span style="color:#e6db74">&#34;GEMINI_API_KEY&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">nzchar</span>(api_key)) {
</span></span><span style="display:flex;"><span>  cli<span style="color:#f92672">::</span><span style="color:#a6e22e">cli_abort</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;{.val GEMINI_API_KEY} environment variable not set. Please set it before running.&#34;</span>
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># To get information about the file</span>
</span></span><span style="display:flex;"><span>file_raw_content <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">readBin</span>(
</span></span><span style="display:flex;"><span>  path,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;raw&#34;</span>,
</span></span><span style="display:flex;"><span>  n <span style="color:#f92672">=</span> <span style="color:#a6e22e">file.info</span>(path)<span style="color:#f92672">$</span>size
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Get upload URL -- step 1</span>
</span></span><span style="display:flex;"><span>upload_resp_start <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">gemini_url</span>(upload <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">request</span>() <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">req_headers</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;x-goog-api-key&#34;</span> <span style="color:#f92672">=</span> api_key,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;X-Goog-Upload-Protocol&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;resumable&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;X-Goog-Upload-Command&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;start&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;X-Goog-Upload-Header-Content-Length&#34;</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">length</span>(file_raw_content),
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;X-Goog-Upload-Header-Content-Type&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;text/markdown&#34;</span>
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">req_body_json</span>(<span style="color:#a6e22e">list</span>(
</span></span><span style="display:flex;"><span>    file <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(
</span></span><span style="display:flex;"><span>      display_name <span style="color:#f92672">=</span> <span style="color:#a6e22e">basename</span>(<span style="color:#a6e22e">dirname</span>(path)),
</span></span><span style="display:flex;"><span>      mime_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;text/markdown&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>  )) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">req_perform</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>upload_url <span style="color:#f92672">&lt;-</span> httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">resp_header</span>(upload_resp_start, <span style="color:#e6db74">&#34;X-Goog-Upload-Url&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">is.null</span>(upload_url)) {
</span></span><span style="display:flex;"><span>  cli<span style="color:#f92672">::</span><span style="color:#a6e22e">cli_abort</span>(<span style="color:#e6db74">&#34;Failed to get upload URL from Files API start request.&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>upload_url
</span></span></code></pre></div><p>Since the heads up request is not sending the file content, it is a very lightweight request.
However, its still important to give the correct type of heads up, so the API knows what to expect.
In this case, we are uploading a markdown file, so we set the <code>Content-Type</code> to <code>text/markdown</code>.
And, we also set the <code>X-Goog-Upload-Header-Content-Length</code> to the size of the file (in bytes) we are uploading.
The <code>display_name</code> is just a human-readable name for the file, which we set to the name of the parent directory of the file we are uploading (because I typically store my blog posts in a subdirectory named after the post).
This function will return the upload URL in the response header, which we can then use to upload the file content in the next step.
I had never worked with a response that returns the upload URL in the header, so I was a bit confused at first.
But once I figured it out, it was quite straightforward.</p>
<h3 id="step-2-uploading-the-file-content">Step 2: Uploading the file content</h3>
<p>Now that we have the upload URL, we can upload the file content.
You will notice that this function is quite similar to the first step, but this time we are sending the actual file content in the request body.
I opted to read the file content as raw bytes, which is a common practice when uploading files to APIs, and it was what worked most reliably during testing.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># Upload file content -- step 2</span>
</span></span><span style="display:flex;"><span>upload_content_resp <span style="color:#f92672">&lt;-</span> httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">request</span>(upload_url) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">req_headers</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Content-Type&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;text/markdown&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;X-Goog-Upload-Command&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;upload, finalize&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;X-Goog-Upload-Offset&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;x-goog-api-key&#34;</span> <span style="color:#f92672">=</span> api_key
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">req_body_raw</span>(file_raw_content) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">req_error</span>(
</span></span><span style="display:flex;"><span>    is_error <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(resp) <span style="color:#66d9ef">FALSE</span>
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">req_perform</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">resp_status</span>(upload_content_resp) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">200</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">stop</span>(<span style="color:#a6e22e">paste</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;File content upload failed with status:&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">resp_status</span>(upload_content_resp),
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;-&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">resp_body_json</span>(upload_content_resp)
</span></span><span style="display:flex;"><span>  ))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>file_info <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">resp_body_json</span>(upload_content_resp)
</span></span><span style="display:flex;"><span>cli<span style="color:#f92672">::</span><span style="color:#a6e22e">cli_alert_info</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;File uploaded successfully! File Name: {.path {file_info$file$name}}&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>file_info<span style="color:#f92672">$</span>file
</span></span></code></pre></div><p>Also notice the <code>req_error()</code> function, which is used to handle errors in a more graceful way.
By default, <code>httr2</code> will stop execution if the request fails with a non-200 status code.
While this is useful in many cases, I wanted to handle the error myself and return a more informative message.
In my experience, the Gemini API returns quite long and sometimes cryptic error messages, so I wanted to include the status code and the error message in the output.</p>
<h3 id="combining-the-steps-into-a-function">Combining the steps into a function</h3>
<p>Now that we have the two steps to upload a file to the Gemini API, we can combine them into a single function that will handle both steps.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>gemini_upload_file <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(path) {
</span></span><span style="display:flex;"><span>  api_key <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">Sys.getenv</span>(<span style="color:#e6db74">&#34;GEMINI_API_KEY&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">nzchar</span>(api_key)) {
</span></span><span style="display:flex;"><span>    cli<span style="color:#f92672">::</span><span style="color:#a6e22e">cli_abort</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;{.val GEMINI_API_KEY} environment variable not set. Please set it before running.&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># To get information about the file</span>
</span></span><span style="display:flex;"><span>  file_raw_content <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">readBin</span>(
</span></span><span style="display:flex;"><span>    path,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;raw&#34;</span>,
</span></span><span style="display:flex;"><span>    n <span style="color:#f92672">=</span> <span style="color:#a6e22e">file.info</span>(path)<span style="color:#f92672">$</span>size
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Get upload URL -- step 1</span>
</span></span><span style="display:flex;"><span>  upload_resp_start <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">gemini_url</span>(upload <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>    httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">request</span>() <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>    httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">req_headers</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;x-goog-api-key&#34;</span> <span style="color:#f92672">=</span> api_key,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;X-Goog-Upload-Protocol&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;resumable&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;X-Goog-Upload-Command&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;start&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;X-Goog-Upload-Header-Content-Length&#34;</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">length</span>(file_raw_content),
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;X-Goog-Upload-Header-Content-Type&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;text/markdown&#34;</span>
</span></span><span style="display:flex;"><span>    ) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>    httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">req_body_json</span>(<span style="color:#a6e22e">list</span>(
</span></span><span style="display:flex;"><span>      file <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(
</span></span><span style="display:flex;"><span>        display_name <span style="color:#f92672">=</span> <span style="color:#a6e22e">basename</span>(<span style="color:#a6e22e">dirname</span>(path)),
</span></span><span style="display:flex;"><span>        mime_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;text/markdown&#34;</span>
</span></span><span style="display:flex;"><span>      )
</span></span><span style="display:flex;"><span>    )) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>    httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">req_perform</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  upload_url <span style="color:#f92672">&lt;-</span> httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">resp_header</span>(upload_resp_start, <span style="color:#e6db74">&#34;X-Goog-Upload-Url&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">is.null</span>(upload_url)) {
</span></span><span style="display:flex;"><span>    cli<span style="color:#f92672">::</span><span style="color:#a6e22e">cli_abort</span>(<span style="color:#e6db74">&#34;Failed to get upload URL from Files API start request.&#34;</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Upload file content -- step 2</span>
</span></span><span style="display:flex;"><span>  upload_content_resp <span style="color:#f92672">&lt;-</span> httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">request</span>(upload_url) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>    httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">req_headers</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;Content-Type&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;text/markdown&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;X-Goog-Upload-Command&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;upload, finalize&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;X-Goog-Upload-Offset&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;0&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;x-goog-api-key&#34;</span> <span style="color:#f92672">=</span> api_key
</span></span><span style="display:flex;"><span>    ) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>    httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">req_body_raw</span>(file_raw_content) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>    httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">req_error</span>(
</span></span><span style="display:flex;"><span>      is_error <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(resp) <span style="color:#66d9ef">FALSE</span>
</span></span><span style="display:flex;"><span>    ) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>    httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">req_perform</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">resp_status</span>(upload_content_resp) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">200</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">stop</span>(<span style="color:#a6e22e">paste</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;File content upload failed with status:&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">resp_status</span>(upload_content_resp),
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;-&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">resp_body_json</span>(upload_content_resp)
</span></span><span style="display:flex;"><span>    ))
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  file_info <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">resp_body_json</span>(upload_content_resp)
</span></span><span style="display:flex;"><span>  cli<span style="color:#f92672">::</span><span style="color:#a6e22e">cli_alert_info</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;File uploaded successfully! File Name: {.path {file_info$file$name}}&#34;</span>
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span>(file_info<span style="color:#f92672">$</span>file)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>With this function, we can now upload a file to the Gemini API and get the file information back.
We can test this out by uploading the markdown file from my previous blog post.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>file <span style="color:#f92672">&lt;-</span> here<span style="color:#f92672">::</span><span style="color:#a6e22e">here</span>(<span style="color:#e6db74">&#34;content/blog/2025/07-01_httr2_client/index.md&#34;</span>)
</span></span><span style="display:flex;"><span>file_info <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">gemini_upload_file</span>(file)
</span></span></code></pre></div><pre><code> File uploaded successfully! File Name: 'files/tvpow4yhdy27'
</code></pre>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>file_info
</span></span></code></pre></div><pre><code>$name
[1] &quot;files/tvpow4yhdy27&quot;

$displayName
[1] &quot;07-01_httr2_client&quot;

$mimeType
[1] &quot;text/markdown&quot;

$sizeBytes
[1] &quot;31073&quot;

$createTime
[1] &quot;2025-07-31T22:52:54.522339Z&quot;

$updateTime
[1] &quot;2025-07-31T22:52:54.522339Z&quot;

$expirationTime
[1] &quot;2025-08-02T22:52:53.772515346Z&quot;

$sha256Hash
[1] &quot;MDhlZTQ0N2ExZDdhMGQ4NjAyYTlmNTA1Mjk1NGJhZDA0ZWExOThhYTE2OTc5MzMzMGExZDliYTU1Y2IwZjhmMA==&quot;

$uri
[1] &quot;https://generativelanguage.googleapis.com/v1beta/files/tvpow4yhdy27&quot;

$state
[1] &quot;ACTIVE&quot;

$source
[1] &quot;UPLOADED&quot;
</code></pre>
<p>A nice feature here is that Gemini will retain the file only for a limited time (48 hours), so you don&rsquo;t have to worry about cleaning up old files.
It&rsquo;s also worth noting that the file is not stored in your Google Drive, but rather in the Gemini API&rsquo;s storage.</p>
<h3 id="step-3-generating-the-content">Step 3: Generating the content</h3>
<p>Now we have the file information, we can use it to call the <code>generateContent</code> endpoint with the prompt.
Using a similar approach as before, I created a function to generate the content from the Gemini API.
The function takes the file information and a prompt as input, and returns the generated content.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>doc_summary <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(
</span></span><span style="display:flex;"><span>  file_info,
</span></span><span style="display:flex;"><span>  prompt <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Please summarize the attached  document concisely, focusing on its overview, key accomplishments, challenges, and next steps.&#34;</span>
</span></span><span style="display:flex;"><span>) {
</span></span><span style="display:flex;"><span>  api_key <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">Sys.getenv</span>(<span style="color:#e6db74">&#34;GEMINI_API_KEY&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">nzchar</span>(api_key)) {
</span></span><span style="display:flex;"><span>    cli<span style="color:#f92672">::</span><span style="color:#a6e22e">cli_abort</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;{.val GEMINI_API_KEY} environment variable not set. Please set it before running.&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  body <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(
</span></span><span style="display:flex;"><span>    contents <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(<span style="color:#a6e22e">list</span>(
</span></span><span style="display:flex;"><span>      parts <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">list</span>(text <span style="color:#f92672">=</span> prompt),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">list</span>(
</span></span><span style="display:flex;"><span>          file_data <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(
</span></span><span style="display:flex;"><span>            mime_type <span style="color:#f92672">=</span> file_info<span style="color:#f92672">$</span>mimeType,
</span></span><span style="display:flex;"><span>            file_uri <span style="color:#f92672">=</span> file_info<span style="color:#f92672">$</span>uri
</span></span><span style="display:flex;"><span>          )
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>      )
</span></span><span style="display:flex;"><span>    ))
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  resp <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">gemini_url</span>(upload <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>    httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">request</span>() <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>    httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">req_headers</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;x-goog-api-key&#34;</span> <span style="color:#f92672">=</span> api_key,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;Content-Type&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;application/json&#34;</span>
</span></span><span style="display:flex;"><span>    ) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>    httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">req_body_json</span>(
</span></span><span style="display:flex;"><span>      body,
</span></span><span style="display:flex;"><span>      auto_unbox <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>
</span></span><span style="display:flex;"><span>    ) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>    httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">req_throttle</span>(rate <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">60</span>) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>    httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">req_error</span>(
</span></span><span style="display:flex;"><span>      is_error <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(resp) <span style="color:#66d9ef">FALSE</span>
</span></span><span style="display:flex;"><span>    ) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>    httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">req_perform</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">resp_status</span>(resp) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">200</span>) {
</span></span><span style="display:flex;"><span>    body <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">resp_has_body</span>(resp)) {
</span></span><span style="display:flex;"><span>      body <span style="color:#f92672">&lt;-</span> httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">resp_body_json</span>(resp)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    cli<span style="color:#f92672">::</span><span style="color:#a6e22e">cli_abort</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;Summary API Request failed with status: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      {.val {resp_status(resp)}} - 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      {.val {resp_status_desc(resp)}} - 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      {.val {body}}&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  json <span style="color:#f92672">&lt;-</span> httr2<span style="color:#f92672">::</span><span style="color:#a6e22e">resp_body_json</span>(resp)
</span></span><span style="display:flex;"><span>  json<span style="color:#f92672">$</span>candidate[[1]]<span style="color:#f92672">$</span>content<span style="color:#f92672">$</span>parts[[1]]<span style="color:#f92672">$</span>text
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>I struggled a little here, as creating the body for the request was a bit tricky.
I also kept getting errors about not having access to project <code>542708778979</code>, which is I project I don&rsquo;t have access to.
I googled around, and even found a post in the <a href="https://discuss.ai.google.dev/t/error-while-using-my-project-changes-to-unkown-project/93735">google ai discussions</a> mentioning this with the same exact error message.
After some trial and error, I noticed what I had overlooked.
My initial function forgot to set the API key in the request headers, which resulted in the error message.
We can all agree, that this is a very misleading error message!
I assume the project ID is a default project that the API uses when no API key is provided, it would have been much clearer if the error message had mentioned that the API key was missing.</p>
<p>After fixing that and getting the request body structure correct, I was able to successfully generate a summary of the blog post.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>summary <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">doc_summary</span>(file_info)
</span></span><span style="display:flex;"><span>summary
</span></span></code></pre></div><pre><code>[1] &quot;This blog post details the author's experience rewriting an R package to connect to a university's survey platform, focusing on migrating from `httr` to `httr2` for OAuth2 Machine-to-Machine (M2M) authentication.  The key accomplishment is creating a robust and reliable client using `httr2::oauth_client` that handles authentication and token management efficiently, resolving previous issues with manual token caching.  Challenges included understanding the unfamiliar M2M flow (as opposed to the more common U2M flow), correctly configuring the `oauth_client` (specifically using `auth = \&quot;header\&quot;`), and setting up a comprehensive test suite using `vcr` for recording API calls and `testthat` with `local_mocked_bindings` to mock functions for reliable testing across different environments (e.g., GitHub Actions).  Next steps involve exploring `vcr::local_cassette` for improved testing readability and implementing a weekly GitHub Action to proactively test the API for changes.  The author also details how they handle vignette knitting to ensure API calls within vignettes function correctly.\n&quot;
</code></pre>
<p>I was quite pleased with the result, as it provided a concise summary of the blog post.
Next step, was to create a function that would generate a series of points suitable for a LinkedIn carousel slide.</p>
<h2 id="creating-a-suitable-prompt">Creating a suitable prompt</h2>
<p>A good prompt is crucial for getting the best results from an LLM.
The prompt should be clear, concise, and provide enough context for the model to understand what is expected.
I started with a simple prompt that asked the model to summarise the content of a blog post into a series of points suitable for a LinkedIn carousel slide.
A carousel can be maximally 10 slides, so I wanted to generate between 5 and 8 points.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>prompt_text <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">paste</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Summarize the following blog post into a series of distinct points, each suitable for a LinkedIn carousel slide.&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;For each point, provide:&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;1. A concise, attention-grabbing title (max 10 words).&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;2. A brief, engaging description (max 50 words) that elaborates on the title.&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Ensure there are at least 5 and no more than 8 points.&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Use code input and output in examples for engagement in extra slides after slides that mention code solutions.&#34;</span>,
</span></span><span style="display:flex;"><span>  sep <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;\n&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">doc_summary</span>(file_info, prompt_text)
</span></span></code></pre></div><pre><code>[1] &quot;Here's a LinkedIn carousel post summarizing the blog post, designed for maximum engagement:\n\n**Slide 1: Title: Conquer OAuth2 M2M with httr2**\n\nDescription:  Master machine-to-machine OAuth2 authentication in R using the powerful httr2 package. This post guides you through seamless client setup and robust API testing.\n\n\n**Slide 2: Title:  From U2M to M2M: Understanding the Difference**\n\nDescription: Learn the key distinctions between User-to-Machine (U2M) and Machine-to-Machine (M2M) OAuth2 flows.  See visual diagrams illustrating each authentication process.  (Include the first Mermaid diagram here.)\n\n\n**Slide 3: Title:  Building Your httr2 OAuth2 Client**\n\nDescription:  Discover how to create a robust httr2 client for M2M authentication. Learn how to leverage environment variables for secure credential management.\n\n\n**Slide 4: Code Example 1 (Client Creation):**\n\n```r\nns_client &lt;- function(client_id, client_secret, client_name = \&quot;nettskjemar\&quot;) {\n  # ... (Code from blog post) ...\n}\n```\n\n**Slide 5: Title:  Mastering httr2's `req_oauth_client_credentials`**\n\nDescription:  Effectively utilize httr2's `req_oauth_client_credentials` function to authenticate your API requests and simplify token management.\n\n\n**Slide 6: Code Example 2 (API Request):**\n\n```r\nhttr2::request(\&quot;https://nettskjema.no/api/v3/\&quot;) |&gt;\n  ns_req_auth() |&gt;\n  httr2::req_url_path_append(\&quot;me\&quot;) |&gt;\n  httr2::req_perform() |&gt;\n  httr2::resp_body_json()\n```\n\n\n**Slide 7: Title:  Rock-Solid API Testing with vcr &amp; Mocking**\n\nDescription:  Learn how to use `vcr` to record and replay API calls for consistent testing, and how to mock functions for comprehensive test coverage. Includes a visual explanation why mocking is important in specific cases.\n\n\n**Slide 8: Code Example 3 (Mocking with `local_mocked_bindings`):**\n\n```r\nwith_mocked_nettskjema_auth &lt;- function(expr) {\n  testthat::local_mocked_bindings(\n    ns_has_auth = function(...) TRUE,\n    .package = \&quot;nettskjemar\&quot;\n  )\n  force(expr)\n}\n```\n\n\n**Slide 9: Title:  Automated API Checks: Future-Proof Your Code**\n\nDescription: Implement a GitHub Actions workflow to periodically test your API calls and receive email notifications for failures. Ensures your code remains compatible with API changes.  (Include relevant parts of YAML file.)\n\n\n**Slide 10: Conclusion:  Level Up Your R API Skills**\n\nDescription:  By mastering these techniques, you can significantly improve the reliability and maintainability of your R-based API interactions.  Share your experiences in the comments!\n\n\nThis structure provides a clear, concise, and engaging narrative flow suitable for a LinkedIn carousel post.  Remember to use relevant visuals and keep the text concise to maintain reader interest.\n&quot;
</code></pre>
<p>The result is pretty good, the summaries and points seem to be relevant and engaging.
The problem is that the output is not in a format that is easy to use for creating a carousel.
So I decided to modify the prompt to output the information in a single line JSON format.
Since I also mainly write about coding, I wanted to include code input and output in the examples for engagement.</p>
<p>This meant adding a few more instructions to the prompt, to add more points and improve the output format.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>prompt_text <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">paste</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Summarize the following blog post into a series of distinct points, each suitable for a LinkedIn carousel slide.&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;For each point, provide:&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;1. A concise, attention-grabbing title (max 10 words).&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;2. A brief, engaging description (max 50 words) that elaborates on the title.&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Ensure there are at least 5 and no more than 8 points.&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Use code input and output in examples for engagement in extra slides after slides that mention code solutions.&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Use image paths from the post where appropriate to create more engaging slides&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Conclude with a final summary slide title and description encouraging engagement.&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Output the information in a single line json, not pretty, without backslashes and information on file type (omit ```json).&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;{title:&lt;input&gt;,slides:[s1:{title, body, input, output}].&#34;</span>,
</span></span><span style="display:flex;"><span>  sep <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;\n&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dsum <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">doc_summary</span>(file_info, prompt_text)
</span></span><span style="display:flex;"><span>dsum
</span></span></code></pre></div><pre><code>[1] &quot;{\&quot;title\&quot;: \&quot;Decoding OAuth2 M2M with httr2\&quot;, \&quot;slides\&quot;: [{\&quot;title\&quot;: \&quot;OAuth2: U2M vs M2M\&quot;, \&quot;body\&quot;: \&quot;Understanding the difference between User-to-Machine (U2M) and Machine-to-Machine (M2M) OAuth2 flows is crucial for successful API integration.  This post focuses on M2M.\&quot;, \&quot;input\&quot;: null, \&quot;output\&quot;: null}, {\&quot;title\&quot;: \&quot;M2M Authentication Flow\&quot;, \&quot;body\&quot;: \&quot;M2M uses client credentials (ID &amp; secret) to directly obtain an access token, eliminating user interaction.  This simplifies programmatic access.\&quot;, \&quot;input\&quot;: null, \&quot;output\&quot;: null}, {\&quot;title\&quot;: \&quot;Setting up the httr2 Client\&quot;, \&quot;body\&quot;: \&quot;Create a robust httr2 client for your M2M needs using client ID, secret, and specifying `auth = \\\&quot;header\\\&quot;` for correct authentication.\&quot;, \&quot;input\&quot;: \&quot;httr2::oauth_client(id = client_id, secret = client_secret, name = client_name, token_url = \\\&quot;https://authorization.nettskjema.no/oauth2/token\\\&quot;, auth = \\\&quot;header\\\&quot;)\&quot;, \&quot;output\&quot;: null}, {\&quot;title\&quot;: \&quot;Using the httr2 Client\&quot;, \&quot;body\&quot;: \&quot;Employ `req_oauth_client_credentials` to authenticate your requests with the newly created client.  It seamlessly handles token management.\&quot;, \&quot;input\&quot;: \&quot;httr2::request(\\\&quot;https://nettskjema.no/api/v3/\\\&quot;) |&gt; ns_req_auth() |&gt; httr2::req_url_path_append(\\\&quot;me\\\&quot;) |&gt; httr2::req_perform() |&gt; httr2::resp_body_json()\&quot;, \&quot;output\&quot;: \&quot;{\\n  \\\&quot;isPersonalDataResponsible\\\&quot;: false,\\n  \\\&quot;displayName\\\&quot;: \\\&quot;ccda25ce-8256-4c6f-ba71-7a4357dc6caf@apiclient\\\&quot;,\\n  ...\\n}\\n\&quot;}, {\&quot;title\&quot;: \&quot;Testing with VCR &amp; Mocking\&quot;, \&quot;body\&quot;: \&quot;Use `vcr` to record and replay API calls, ensuring consistent test results.  Mock functions like `ns_has_auth` for reliable testing, avoiding external dependencies during testing.\&quot;, \&quot;input\&quot;: null, \&quot;output\&quot;: null}, {\&quot;title\&quot;: \&quot;Mocking ns_has_auth\&quot;, \&quot;body\&quot;: \&quot;Use `testthat::local_mocked_bindings` to mock the `ns_has_auth` function, ensuring tests always pass authentication checks regardless of environment variables.\&quot;, \&quot;input\&quot;: \&quot;testthat::local_mocked_bindings(ns_has_auth = function(...) TRUE, .package = \\\&quot;nettskjemar\\\&quot;)\&quot;, \&quot;output\&quot;: null}, {\&quot;title\&quot;: \&quot;GitHub Actions for API Testing\&quot;, \&quot;body\&quot;: \&quot;Implement a weekly GitHub Actions workflow to automatically test your API calls, ensuring your package remains compatible with the API over time.  Get email alerts for failures.\&quot;, \&quot;input\&quot;: null, \&quot;output\&quot;: null}, {\&quot;title\&quot;: \&quot;Knitting Vignettes with API Calls\&quot;, \&quot;body\&quot;: \&quot;Handle vignettes that require API interaction by creating separate `.orig` files and building them using an internal function.  This prevents build issues.\&quot;, \&quot;input\&quot;: null, \&quot;output\&quot;: null}], \&quot;conclusion\&quot;: {\&quot;title\&quot;: \&quot;Mastering OAuth2 M2M Testing\&quot;, \&quot;body\&quot;: \&quot;Learn how to effectively test your OAuth2 M2M API interactions using httr2, VCR, and mocking. Share your mocking strategies in the comments!\&quot;}}\n&quot;
</code></pre>
<p>Now we are getting closer, though you might still find that output daunting.
And it is! Until we read that json into an R list!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>jdsum <span style="color:#f92672">&lt;-</span> jsonlite<span style="color:#f92672">::</span><span style="color:#a6e22e">fromJSON</span>(dsum)
</span></span><span style="display:flex;"><span>jdsum
</span></span></code></pre></div><pre><code>$title
[1] &quot;Decoding OAuth2 M2M with httr2&quot;

$slides
                              title
1                OAuth2: U2M vs M2M
2           M2M Authentication Flow
3       Setting up the httr2 Client
4            Using the httr2 Client
5        Testing with VCR &amp; Mocking
6               Mocking ns_has_auth
7    GitHub Actions for API Testing
8 Knitting Vignettes with API Calls
                                                                                                                                                                                 body
1          Understanding the difference between User-to-Machine (U2M) and Machine-to-Machine (M2M) OAuth2 flows is crucial for successful API integration.  This post focuses on M2M.
2                                   M2M uses client credentials (ID &amp; secret) to directly obtain an access token, eliminating user interaction.  This simplifies programmatic access.
3                                               Create a robust httr2 client for your M2M needs using client ID, secret, and specifying `auth = &quot;header&quot;` for correct authentication.
4                                         Employ `req_oauth_client_credentials` to authenticate your requests with the newly created client.  It seamlessly handles token management.
5 Use `vcr` to record and replay API calls, ensuring consistent test results.  Mock functions like `ns_has_auth` for reliable testing, avoiding external dependencies during testing.
6                     Use `testthat::local_mocked_bindings` to mock the `ns_has_auth` function, ensuring tests always pass authentication checks regardless of environment variables.
7   Implement a weekly GitHub Actions workflow to automatically test your API calls, ensuring your package remains compatible with the API over time.  Get email alerts for failures.
8                         Handle vignettes that require API interaction by creating separate `.orig` files and building them using an internal function.  This prevents build issues.
                                                                                                                                                             input
1                                                                                                                                                             &lt;NA&gt;
2                                                                                                                                                             &lt;NA&gt;
3 httr2::oauth_client(id = client_id, secret = client_secret, name = client_name, token_url = &quot;https://authorization.nettskjema.no/oauth2/token&quot;, auth = &quot;header&quot;)
4          httr2::request(&quot;https://nettskjema.no/api/v3/&quot;) |&gt; ns_req_auth() |&gt; httr2::req_url_path_append(&quot;me&quot;) |&gt; httr2::req_perform() |&gt; httr2::resp_body_json()
5                                                                                                                                                             &lt;NA&gt;
6                                                                      testthat::local_mocked_bindings(ns_has_auth = function(...) TRUE, .package = &quot;nettskjemar&quot;)
7                                                                                                                                                             &lt;NA&gt;
8                                                                                                                                                             &lt;NA&gt;
                                                                                                                    output
1                                                                                                                     &lt;NA&gt;
2                                                                                                                     &lt;NA&gt;
3                                                                                                                     &lt;NA&gt;
4 {\n  &quot;isPersonalDataResponsible&quot;: false,\n  &quot;displayName&quot;: &quot;ccda25ce-8256-4c6f-ba71-7a4357dc6caf@apiclient&quot;,\n  ...\n}\n
5                                                                                                                     &lt;NA&gt;
6                                                                                                                     &lt;NA&gt;
7                                                                                                                     &lt;NA&gt;
8                                                                                                                     &lt;NA&gt;

$conclusion
$conclusion$title
[1] &quot;Mastering OAuth2 M2M Testing&quot;

$conclusion$body
[1] &quot;Learn how to effectively test your OAuth2 M2M API interactions using httr2, VCR, and mocking. Share your mocking strategies in the comments!&quot;
</code></pre>
<p>This gives us a structured list that we can more easily manipulate in R.</p>
<h2 id="creating-a-quarto-document-for-the-carousel">Creating a Quarto document for the carousel</h2>
<p>Next piece of the puzzle is to create a LinkedIn carousel from the generated content.
I opted for using Quarto to create the carousel, as it allows for easy formatting and customization.
The idea being that I can generate a Quarto document that can render a reveal.js presentation, which I can then turn into a pdf for a LinkedIn carousel.
This allows me to optimize the layout and design of the carousel, and to have an intermediate step where I can review the content before posting it on LinkedIn.
LLMs are great, but I still want to have some control over the final output.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>generate_md_carousel <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(
</span></span><span style="display:flex;"><span>  content,
</span></span><span style="display:flex;"><span>  output_file <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;highlights.qmd&#34;</span>
</span></span><span style="display:flex;"><span>) {
</span></span><span style="display:flex;"><span>  markdown_lines <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;---&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">paste</span>(<span style="color:#e6db74">&#34;title: &#34;</span>, <span style="color:#a6e22e">gsub</span>(<span style="color:#e6db74">&#34;:&#34;</span>, <span style="color:#e6db74">&#34; -&#34;</span>, content<span style="color:#f92672">$</span>title)),
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;format:&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;  revealjs:&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;    theme: default&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;    slide-number: false&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;    controls: false&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;    fragment: false&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;    hash-for-ids: true&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;    embed-resources: true&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;    self-contained: true&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;---&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (i <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">nrow</span>(content<span style="color:#f92672">$</span>slides)) {
</span></span><span style="display:flex;"><span>    slide_data <span style="color:#f92672">&lt;-</span> content<span style="color:#f92672">$</span>slides[i, ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">is.na</span>(slide_data<span style="color:#f92672">$</span>title) <span style="color:#f92672">&amp;&amp;</span> slide_data<span style="color:#f92672">$</span>title <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span>) {
</span></span><span style="display:flex;"><span>      markdown_lines <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(
</span></span><span style="display:flex;"><span>        markdown_lines,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;# &#34;</span>, slide_data<span style="color:#f92672">$</span>title),
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>      )
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">is.na</span>(slide_data<span style="color:#f92672">$</span>body) <span style="color:#f92672">&amp;&amp;</span> slide_data<span style="color:#f92672">$</span>body <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span>) {
</span></span><span style="display:flex;"><span>      markdown_lines <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(
</span></span><span style="display:flex;"><span>        markdown_lines,
</span></span><span style="display:flex;"><span>        slide_data<span style="color:#f92672">$</span>body,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>      )
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">is.na</span>(slide_data<span style="color:#f92672">$</span>input) <span style="color:#f92672">&amp;&amp;</span> slide_data<span style="color:#f92672">$</span>input <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span>) {
</span></span><span style="display:flex;"><span>      markdown_lines <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(
</span></span><span style="display:flex;"><span>        markdown_lines,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        slide_data<span style="color:#f92672">$</span>input,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>      )
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">is.na</span>(slide_data<span style="color:#f92672">$</span>output) <span style="color:#f92672">&amp;&amp;</span> slide_data<span style="color:#f92672">$</span>output <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span>) {
</span></span><span style="display:flex;"><span>      markdown_lines <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(
</span></span><span style="display:flex;"><span>        markdown_lines,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        slide_data<span style="color:#f92672">$</span>output,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>      )
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">writeLines</span>(
</span></span><span style="display:flex;"><span>    markdown_lines,
</span></span><span style="display:flex;"><span>    output_file,
</span></span><span style="display:flex;"><span>    useBytes <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>  cli<span style="color:#f92672">::</span><span style="color:#a6e22e">cli_text</span>(<span style="color:#e6db74">&#34;Quarto Markdown file generated: {.path {output_file}}&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">invisible</span>(markdown_lines)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Again, a rather large function, but since the output is structured, we can easily iterate over the slides and generate the markdown content.
The function starts by creating the YAML header for the Quarto document, setting the title and format options.
Then, it loops through each slide in the content, adding the title, body, input, and output sections as needed.
It stores all the markdown lines in a character vector called <code>markdown_lines</code>, which is then written to a file specified by <code>output_file</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>qmd <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">generate_md_carousel</span>(jdsum)
</span></span></code></pre></div><pre><code>Quarto Markdown file generated: 'highlights.qmd'
</code></pre>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>qmd
</span></span></code></pre></div><pre><code> [1] &quot;---&quot;                                                                                                                                                                                
 [2] &quot;title:  Decoding OAuth2 M2M with httr2&quot;                                                                                                                                             
 [3] &quot;format:&quot;                                                                                                                                                                            
 [4] &quot;  revealjs:&quot;                                                                                                                                                                        
 [5] &quot;    theme: default&quot;                                                                                                                                                                 
 [6] &quot;    slide-number: false&quot;                                                                                                                                                            
 [7] &quot;    controls: false&quot;                                                                                                                                                                
 [8] &quot;    fragment: false&quot;                                                                                                                                                                
 [9] &quot;    hash-for-ids: true&quot;                                                                                                                                                             
[10] &quot;    embed-resources: true&quot;                                                                                                                                                          
[11] &quot;    self-contained: true&quot;                                                                                                                                                           
[12] &quot;---&quot;                                                                                                                                                                                
[13] &quot;&quot;                                                                                                                                                                                   
[14] &quot;# OAuth2: U2M vs M2M&quot;                                                                                                                                                               
[15] &quot;&quot;                                                                                                                                                                                   
[16] &quot;Understanding the difference between User-to-Machine (U2M) and Machine-to-Machine (M2M) OAuth2 flows is crucial for successful API integration.  This post focuses on M2M.&quot;         
[17] &quot;&quot;                                                                                                                                                                                   
[18] &quot;# M2M Authentication Flow&quot;                                                                                                                                                          
[19] &quot;&quot;                                                                                                                                                                                   
[20] &quot;M2M uses client credentials (ID &amp; secret) to directly obtain an access token, eliminating user interaction.  This simplifies programmatic access.&quot;                                  
[21] &quot;&quot;                                                                                                                                                                                   
[22] &quot;# Setting up the httr2 Client&quot;                                                                                                                                                      
[23] &quot;&quot;                                                                                                                                                                                   
[24] &quot;Create a robust httr2 client for your M2M needs using client ID, secret, and specifying `auth = \&quot;header\&quot;` for correct authentication.&quot;                                            
[25] &quot;&quot;                                                                                                                                                                                   
[26] &quot;&quot;                                                                                                                                                                                   
[27] &quot;httr2::oauth_client(id = client_id, secret = client_secret, name = client_name, token_url = \&quot;https://authorization.nettskjema.no/oauth2/token\&quot;, auth = \&quot;header\&quot;)&quot;               
[28] &quot;&quot;                                                                                                                                                                                   
[29] &quot;# Using the httr2 Client&quot;                                                                                                                                                           
[30] &quot;&quot;                                                                                                                                                                                   
[31] &quot;Employ `req_oauth_client_credentials` to authenticate your requests with the newly created client.  It seamlessly handles token management.&quot;                                        
[32] &quot;&quot;                                                                                                                                                                                   
[33] &quot;&quot;                                                                                                                                                                                   
[34] &quot;httr2::request(\&quot;https://nettskjema.no/api/v3/\&quot;) |&gt; ns_req_auth() |&gt; httr2::req_url_path_append(\&quot;me\&quot;) |&gt; httr2::req_perform() |&gt; httr2::resp_body_json()&quot;                        
[35] &quot;&quot;                                                                                                                                                                                   
[36] &quot;&quot;                                                                                                                                                                                   
[37] &quot;{\n  \&quot;isPersonalDataResponsible\&quot;: false,\n  \&quot;displayName\&quot;: \&quot;ccda25ce-8256-4c6f-ba71-7a4357dc6caf@apiclient\&quot;,\n  ...\n}\n&quot;                                                     
[38] &quot;&quot;                                                                                                                                                                                   
[39] &quot;# Testing with VCR &amp; Mocking&quot;                                                                                                                                                       
[40] &quot;&quot;                                                                                                                                                                                   
[41] &quot;Use `vcr` to record and replay API calls, ensuring consistent test results.  Mock functions like `ns_has_auth` for reliable testing, avoiding external dependencies during testing.&quot;
[42] &quot;&quot;                                                                                                                                                                                   
[43] &quot;# Mocking ns_has_auth&quot;                                                                                                                                                              
[44] &quot;&quot;                                                                                                                                                                                   
[45] &quot;Use `testthat::local_mocked_bindings` to mock the `ns_has_auth` function, ensuring tests always pass authentication checks regardless of environment variables.&quot;                    
[46] &quot;&quot;                                                                                                                                                                                   
[47] &quot;&quot;                                                                                                                                                                                   
[48] &quot;testthat::local_mocked_bindings(ns_has_auth = function(...) TRUE, .package = \&quot;nettskjemar\&quot;)&quot;                                                                                      
[49] &quot;&quot;                                                                                                                                                                                   
[50] &quot;# GitHub Actions for API Testing&quot;                                                                                                                                                   
[51] &quot;&quot;                                                                                                                                                                                   
[52] &quot;Implement a weekly GitHub Actions workflow to automatically test your API calls, ensuring your package remains compatible with the API over time.  Get email alerts for failures.&quot;  
[53] &quot;&quot;                                                                                                                                                                                   
[54] &quot;# Knitting Vignettes with API Calls&quot;                                                                                                                                                
[55] &quot;&quot;                                                                                                                                                                                   
[56] &quot;Handle vignettes that require API interaction by creating separate `.orig` files and building them using an internal function.  This prevents build issues.&quot;                        
[57] &quot;&quot;                                                                                                                                                                                   
</code></pre>
<p>Look at that Quarto markdown file!
I&rsquo;m really quite happy with how this turned out.
It&rsquo;s not perfect, but it gives me a good starting point for manually tweaking the content before posting it on LinkedIn.</p>
<h2 id="the-orchestration-function">The Orchestration Function</h2>
<p>Now that we have all the pieces in place, we can create a function that takes a markdown file path and generates a LinkedIn carousel from it.
The <code>create_li_carousel()</code> function brings together the logic we developed earlier.</p>
<p>It performs the following steps:</p>
<ol>
<li><strong>Define the Prompt:</strong> It first sets up the detailed prompt we crafted to get a JSON-formatted, multi-slide summary from Gemini.
This prompt is crucial as it guides the LLM to provide exactly what we need for our carousel.</li>
<li><strong>Prepare the File:</strong> It calls the <code>gemini_upload_file()</code> function to upload the specified markdown file to Gemini.</li>
<li><strong>Generate the Content:</strong> It calls the <code>generate_doc_summary()</code> function, passing the file path and our specific prompt.
Inside <code>generate_doc_summary()</code>, the file is uploaded to the Gemini API, and the summary is requested.</li>
<li><strong>Parse the JSON:</strong> The raw text response from the API is a single-line JSON string.
The function uses <code>jsonlite::fromJSON()</code> to parse this into a structured R list, making it easy to work with.</li>
<li><strong>Create the Quarto File:</strong> Finally, it calls the <code>generate_md_carousel()</code> function with the structured R list.
This function iterates through the slides and their content to dynamically create a <code>.qmd</code> file.</li>
</ol>
<p>This entire process is wrapped into a single, convenient function call.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>create_li_carousel <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(path) {
</span></span><span style="display:flex;"><span>  prompt_text <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">paste</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Summarize the following blog post into a series of distinct points, each suitable for a LinkedIn carousel slide.&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;For each point, provide:&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;1. A concise, attention-grabbing title (max 10 words).&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;2. A brief, engaging description (max 50 words) that elaborates on the title.&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Ensure there are at least 5 and no more than 8 points.&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Use code input and output in examples for engagement in extra slides after slides that mention code solutions.&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Use image paths from the post where appropriate to create more engaging slides&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Conclude with a final summary slide title and description encouraging engagement.&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Output the information in a single line json, not pretty, without backslashes and information on file type (omit ```json).&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;{title:&lt;input&gt;,slides:[s1:{title, body, input, output}].&#34;</span>,
</span></span><span style="display:flex;"><span>    sep <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;\n&#34;</span>
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gemini_upload_file</span>(path) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">doc_summary</span>(prompt_text) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>    jsonlite<span style="color:#f92672">::</span><span style="color:#a6e22e">fromJSON</span>() <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">generate_md_carousel</span>(
</span></span><span style="display:flex;"><span>      output_file <span style="color:#f92672">=</span> here<span style="color:#f92672">::</span><span style="color:#a6e22e">here</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">dirname</span>(path),
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;highlights.qmd&#34;</span>
</span></span><span style="display:flex;"><span>      )
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>qmd <span style="color:#f92672">&lt;-</span> here<span style="color:#f92672">::</span><span style="color:#a6e22e">here</span>(<span style="color:#e6db74">&#34;content/blog/2025/07-01_httr2_client/index.md&#34;</span>) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">create_li_carousel</span>()
</span></span></code></pre></div><pre><code> File uploaded successfully! File Name: 'files/hpiwjmsnculj'

Quarto Markdown file generated:
'/Users/athanasm/workspace/random/drmowinckels.github.io/content/blog/2025/07-01_httr2_client/highlights.qmd'
</code></pre>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>qmd
</span></span></code></pre></div><pre><code> [1] &quot;---&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 [2] &quot;title:  Decoding OAuth2 M2M with httr2&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 [3] &quot;format:&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 [4] &quot;  revealjs:&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 [5] &quot;    theme: default&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 [6] &quot;    slide-number: false&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 [7] &quot;    controls: false&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 [8] &quot;    fragment: false&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 [9] &quot;    hash-for-ids: true&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
[10] &quot;    embed-resources: true&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
[11] &quot;    self-contained: true&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
[12] &quot;---&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
[13] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[14] &quot;# OAuth2: U2M vs. M2M&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
[15] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[16] &quot;Understanding the difference between User-to-Machine (U2M) and Machine-to-Machine (M2M) OAuth2 flows is crucial for successful API integration.  M2M authentication, used in this project, requires client credentials for direct resource access.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
[17] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[18] &quot;# U2M Flow Diagram&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
[19] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[20] &quot;Visual representation of the U2M flow (User initiates, gets redirected to Auth Server for consent, then client receives token).&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
[21] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[22] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[23] &quot;```mermaid\nsequenceDiagram\n    title U2M (User-to-Machine) Flow: Authorization Code Grant\n    actor User\n    participant ClientApp as Client App\n    participant AuthServer as Authorization Server\n    participant ResourceServer as Resource Server\n\n    User-&gt;&gt;+ClientApp: 1. Initiates action (e.g., clicks 'Log in')\n    ClientApp--&gt;&gt;-User: 2. Redirects browser to Auth Server for authorization\n\n    User-&gt;&gt;+AuthServer: 3. Logs in and grants consent\n    AuthServer--&gt;&gt;-User: 4. Redirects browser back to Client App with Authorization Code\n\n    ClientApp-&gt;&gt;+AuthServer: 5. Exchanges Authorization Code for Access Token (back-channel)\n    AuthServer--&gt;&gt;-ClientApp: 6. Responds with Access Token &amp; Refresh Token\n\n    ClientApp-&gt;&gt;+ResourceServer: 7. Requests protected resource with Access Token\n    ResourceServer--&gt;&gt;-ClientApp: 8. Returns requested data\n```&quot;
[24] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[25] &quot;# M2M Flow Diagram&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
[26] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[27] &quot;Illustrates the simplified M2M flow (Client directly requests a token using its credentials).&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
[28] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[29] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[30] &quot;```mermaid\nsequenceDiagram\n    title M2M (Machine-to-Machine) Flow: Client Credentials Grant\n    participant ClientApp as Client App\n    participant AuthServer as Authorization Server\n    participant ResourceServer as Resource Server\n\n    ClientApp-&gt;&gt;+AuthServer: 1. Requests Access Token using its credentials (client_id, client_secret)\n    AuthServer--&gt;&gt;-ClientApp: 2. Validates credentials and returns Access Token\n\n    ClientApp-&gt;&gt;+ResourceServer: 3. Requests protected resource with Access Token\n    ResourceServer--&gt;&gt;-ClientApp: 4. Returns requested data\n```&quot;                                                                                                                                                                                                                                                                                                       
[31] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[32] &quot;# httr2 Client Setup&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
[33] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[34] &quot;Creating an httr2 OAuth2 client using client ID and secret. The `auth = \&quot;header\&quot; ` argument was crucial for successful authentication.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
[35] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[36] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[37] &quot;```r\nns_client &lt;- function(\n  client_id,\n  client_secret,\n  client_name = \&quot;nettskjemar\&quot;\n) {\n  # ... (function body) ...\n}\n```&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
[38] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[39] &quot;# Using the httr2 Client&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
[40] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[41] &quot;Leveraging `req_oauth_client_credentials` for authenticated API requests.  This function handles token retrieval and caching, simplifying API interaction.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
[42] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[43] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[44] &quot;```r\nhttr2::request(\&quot;https://nettskjema.no/api/v3/\&quot;) |&gt;\n  ns_req_auth() |&gt;\n  httr2::req_url_path_append(\&quot;me\&quot;) |&gt;\n  httr2::req_perform() |&gt;\n  httr2::resp_body_json()\n```&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
[45] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[46] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[47] &quot;```\n$isPersonalDataResponsible\n[1] FALSE\n\n$displayName\n[1] \&quot;ccda25ce-8256-4c6f-ba71-7a4357dc6caf@apiclient\&quot;\n\n$logoutLink\n[1] \&quot;/signout\&quot;\n\n$isSuperUser\n[1] FALSE\n\n$isAuthenticated\n[1] TRUE\n\n$userType\n[1] \&quot;UNKNOWN_ROLE\&quot;\n\n$hasAcceptedTos\n[1] TRUE\n\n$isSupportUser\n[1] FALSE\n\n$isAdministrativeUser\n[1] TRUE\n\n$isInLdapGroupUioTils\n[1] FALSE\n```&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
[48] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[49] &quot;# Testing with VCR&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
[50] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[51] &quot;Using `vcr` to record and replay API calls for reliable and repeatable tests.  `filter_sensitive_data` protects secrets during testing.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
[52] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[53] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[54] &quot;```r\ntest_that(\&quot;test user information\&quot;, {\n  vcr::use_cassette(\&quot;ns_get_me\&quot;, {\n    me &lt;- ns_get_me()\n  })\n\n  expect_is(me, \&quot;list\&quot;)\n  expect_length(me, 10)\n})\n```&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
[55] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[56] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[57] &quot;```yml\nhttp_interactions:\n  - request:\n      method: get\n      uri: https://nettskjema.no/api/v3/me\n      body:\n        encoding: \&quot;\&quot;\n        string: \&quot;\&quot;\n      headers: []\n    response:\n      status:\n        status_code: 200\n        message: OK\n      headers: ...\n```&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
[58] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[59] &quot;# Mocking Functions&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
[60] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[61] &quot;Using `testthat::local_mocked_bindings` to mock the authentication check function (`ns_has_auth`) during API testing, ensuring tests run even without proper environment setup.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
[62] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[63] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[64] &quot;```r\nwith_mocked_nettskjema_auth &lt;- function(expr) {\n  testthat::local_mocked_bindings(\n    ns_has_auth = function(...) TRUE,\n    .package = \&quot;nettskjemar\&quot;\n  )\n  force(expr)\n}\n```&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
[65] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[66] &quot;# GitHub Actions for API Testing&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[67] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[68] &quot;Weekly automated API testing using GitHub Actions to detect API changes and ensure ongoing functionality. &quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
[69] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[70] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[71] &quot;```yaml\n# ... (GitHub Actions YAML)\n```&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
[72] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[73] &quot;# API-Driven Vignette Generation&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[74] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[75] &quot;Creating vignettes that dynamically interact with the API.  An internal function handles knitting and image management.&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
[76] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[77] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[78] &quot;```r\nknit_vignettes &lt;- function() {\n  # ... (function body) ...\n}\n```&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
[79] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[80] &quot;# Wrap Up &amp; Engage!&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
[81] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
[82] &quot;Learn how to use httr2 for OAuth2 M2M, test effectively with VCR, and mock functions. Share your testing strategies in the comments!&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
[83] &quot;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
</code></pre>
<p>This function can now be used to generate a LinkedIn carousel from any markdown file.</p>
<p>With the individual components of our workflow now in place, let&rsquo;s visualize how they all fit together.
The following diagram illustrates the flow of communication between our R script and the Gemini API, from uploading the file to generating the final content.</p>
<pre class="mermaid">
  ---
config:
  theme: &#39;base&#39;
  themeVariables:
    primaryColor: &#39;#116162&#39;
    primaryTextColor: &#39;#d9ebec&#39;
    primaryBorderColor: &#39;#116162&#39;
    lineColor: &#39;#116162&#39;
    secondaryColor: &#39;#843c83&#39;
    tertiaryColor: &#39;#d9ebec&#39;
---

graph TD
    subgraph R Script
        B{Path to file} --&gt; C(Request Upload URL);
        D(Upload file to API);
        E(Summarise document);
        G(Process JSON response);
        G --&gt; H(Generate Quarto markdown);
    end
    
    subgraph Gemini API
        J[Get Upload URL endpoint];
        K[File Upload endpoint];
        L[Generate Content endpoint];
    end

    C -- &#34;Request with X-Goog-Upload-Command: start&#34; --&gt; J;
    J -- &#34;Returns X-Goog-Upload-Url&#34; --&gt; D;
    D -- &#34;Sends raw file data&#34; --&gt; K;
    K -- &#34;Returns file_info object with file_uri&#34; --&gt; E;
    E -- &#34;Request with prompt and file_uri`&#34; --&gt; L;
    L -- &#34;Returns generated content&#34; --&gt; G;
</pre>
<p>This visual representation makes it easier to understand the full orchestration of the process.
At least for me, it helps to see how the different components interact and how data flows through the system.</p>
<h2 id="what-about-the-linkedin-post">What about the LinkedIn post?</h2>
<p>I was of course exploring how to post the generated carousel to LinkedIn directly from R.
Unfortunately, LinkedIn&rsquo;s API is quite restrictive when it comes to posting carousels.
You can post images, but not in a carousel format, at least not in the free tier.
From what I can gather, you need the <a href="https://learn.microsoft.com/en-us/linkedin/marketing/integrations/ads/advertising-targeting/version/carousel-ads-integrations?view=li-lms-2025-06&amp;tabs=http">LinkedIn Advertising API</a> to post carousels, which is not available for free.
So I will have to manually upload the generated Quarto markdown file as a PDF to LinkedIn.</p>
<h2 id="conclusion">Conclusion</h2>
<p>This was a fun and challenging exercise in using the Gemini API to generate content for a LinkedIn carousel.
While I&rsquo;m disappointed that I can&rsquo;t post the carousel directly to LinkedIn from R, I&rsquo;m still very pleased with the results.
This automated workflow gives me a robust starting point for creating polished, professional-looking content without having to start from scratch.
This gives you the best of both worlds: automation for efficiency and human oversight for quality.</p>
<p>Would you use a process like this to generate content for your LinkedIn posts?
If you&rsquo;re interested in generating other types of content with Quarto, I highly recommend checking out Danielle Navarro&rsquo;s post &ldquo;<a href="https://blog.djnavarro.net/posts/2025-07-05_quarto-syntax-from-r/">Generating quarto syntax within R</a>&rdquo;, which offers more great ideas and examples.</p>

        </div>
    </article><div class="uk-margin">
    <button  class="uk-button uk-button-default" uk-toggle="target: #citation; animation: uk-animation-fade" type="button">
        Cite me!
    </button>
    <div id="citation" hidden class="uk-margin">
        <div uk-grid class="uk-child-width-1-2@s">
            <div>
                For attribution, please cite this work as
                <div class="uk-card uk-card-default uk-card-bod uk-text-breaky">
                    Dr. Mowinckel 
                    (Aug 1, 2025) 
                    Automate LinkedIn Carousels with R and Gemini. 
                    Retrieved from https://drmowinckels.io/blog/2025/linkedin_gemini/.
                     DOI: https://www.doi.org/10.5281/zenodo.16681773
                </div>
            </div>
            <div>
                <b>BibTeX citation</b>
                <div class="uk-card uk-card-default uk-card-body uk-text-break">
                    @misc{ <br>
                        2025-automate-linkedin-carousels-with-r-and-gemini,<br>
                        &emsp;author =  "Dr. Mowinckel",<br>
                        &emsp;title = "Automate LinkedIn Carousels with R and Gemini",<br>
                        &emsp;url = "https://drmowinckels.io/blog/2025/linkedin_gemini/",<br>
                        &emsp;year = 2025,<br>
                         &emsp;doi = "https://www.doi.org/10.5281/zenodo.16681773",<br> 
                        &emsp;updated = "Sep 2, 2025"<br>
                    }
                </div>
            </div>
        </div>
    </div>
</div><div class="section" style="height: auto !important;">
        <div class="uk-section">
            
            <div class="uk-position-relative uk-visible-toggle uk-light timeline-horizontal" tabindex="-1" uk-slider="clsActivated: uk-transition-active; center: true">

                <ul class="uk-slider-items uk-grid" >
                    
                    
                        <li class="uk-width-3-4" >
                            <div class="timeline-item timeline-item-horizontal">
  

  
  <div class="timeline-date">
    Jul 01, 2025
  </div>

  <div class="timeline-dot"></div>
  <div class="timeline-content">
      
      

      
      
      
        
          
        
      
      
      
      
    <h2>Decoding OAuth2 M2M with httr2: Client Setup &amp; API Testing</h2>
    
      <p>This post details the process of setting up an OAuth2 Machine-to-Machine (M2M) client using the httr2 package in R.  It covers client creation, handling authentication flows, and comprehensively testing API calls using the vcr package for request recording and testthat for mocking functions to ensure robust and reliable package development.</p>
    
    <div class="uk-flex uk-flex-between uk-flex-middle ">
      
        <a class="btn-more" href="https://drmowinckels.io/blog/2025/httr2_client/">
          Read
        </a>
      
    
      
        <span class="uk-text-right">
          
           
            
                <div class="uk-label timeline-tags">r</div>
            
          
           
            
                <div class="uk-label timeline-tags">api</div>
            
          
        </span>
      
    </div>
  </div>
</div> 
                        </li>
                    
                    
                        <li class="uk-width-3-4" >
                            <div class="timeline-item timeline-item-horizontal">
  

  
  <div class="timeline-date">
    Mar 03, 2025
  </div>

  <div class="timeline-dot"></div>
  <div class="timeline-content">
      
      

      
      
      
        
          
        
      
      
      
      
    <h2>Harness Local LLMs and GitHub Copilot for Enhanced R Package Development</h2>
    
      <p>In this post I explore local large language models (LLMs) with R for code assistance, using tools like chores, ensure, gander, and continue in Positron. The post explores R options and keybindings for various tools, adjusting settings to optimize performance. Lastly, I switch to GitHub Copilot for better results, encountering rate limits but finding workarounds to control autocomplete triggers.</p>
    
    <div class="uk-flex uk-flex-between uk-flex-middle ">
      
        <a class="btn-more" href="https://drmowinckels.io/blog/2025/ollama/">
          Read
        </a>
      
    
      
        <span class="uk-text-right">
          
           
            
                <div class="uk-label timeline-tags">r</div>
            
          
           
            
                <div class="uk-label timeline-tags">ollama</div>
            
          
           
            
                <div class="uk-label timeline-tags">api</div>
            
          
           
            
                <div class="uk-label timeline-tags">llm</div>
            
          
        </span>
      
    </div>
  </div>
</div> 
                        </li>
                    
                    
                        <li class="uk-width-3-4" >
                            <div class="timeline-item timeline-item-horizontal">
  

  
  <div class="timeline-date">
    Feb 01, 2025
  </div>

  <div class="timeline-dot"></div>
  <div class="timeline-content">
      
      

      
      
      
        
          
        
      
      
      
      
    <h2>Cracking the LinkedIn API through R</h2>
    
      <p>I share my experience integrating R with the LinkedIn API, focusing on personal authentication and posting processes. The documentation and workflow were complex, but with help from the rOpenSci community, I successfully navigated the challenges. I detail steps for API access, authentication, and creating posts, highlighting key obstacles like managing OAuth tokens, API products, and endpoints.</p>
    
    <div class="uk-flex uk-flex-between uk-flex-middle ">
      
        <a class="btn-more" href="https://drmowinckels.io/blog/2025/linkedin-api/">
          Read
        </a>
      
    
      
        <span class="uk-text-right">
          
           
            
                <div class="uk-label timeline-tags">r</div>
            
          
           
            
                <div class="uk-label timeline-tags">linkedin</div>
            
          
           
            
                <div class="uk-label timeline-tags">api</div>
            
          
           
            
                <div class="uk-label timeline-tags">github</div>
            
          
        </span>
      
    </div>
  </div>
</div> 
                        </li>
                    
                    
                        <li class="uk-width-3-4" >
                            <div class="timeline-item timeline-item-horizontal">
  

  
  <div class="timeline-date">
    Jun 02, 2025
  </div>

  <div class="timeline-dot"></div>
  <div class="timeline-content">
      
      

      
      
      
        
          
        
      
      
      
      
    <h2>Unmasking Long Covid: PCA &amp; Clustering Analysis of Symptom Syndromes</h2>
    
      <p>This blog post delves into the my personal Long Covid data, collected via the Visible app, using Principal Component Analysis (PCA). I detail four key clusters: Menstruation, Exertion, Emotional, and Neurological and then compare these clusters to the principal components derived from PCA. The analysis aims to provide a validated, data-driven framework for exploring my symptoms during this condition, using clear visualisations to showcase the results.</p>
    
    <div class="uk-flex uk-flex-between uk-flex-middle ">
      
        <a class="btn-more" href="https://drmowinckels.io/blog/2025/visible-pca/">
          Read
        </a>
      
    
      
        <span class="uk-text-right">
          
           
            
                <div class="uk-label timeline-tags">r</div>
            
          
           
            
                <div class="uk-label timeline-tags">health-data</div>
            
          
           
            
                <div class="uk-label timeline-tags">longcovid</div>
            
          
        </span>
      
    </div>
  </div>
</div> 
                        </li>
                    
                    
                        <li class="uk-width-3-4" >
                            <div class="timeline-item timeline-item-horizontal">
  

  
  <div class="timeline-date">
    May 01, 2025
  </div>

  <div class="timeline-dot"></div>
  <div class="timeline-content">
      
      

      
      
      
        
          
        
      
      
      
      
    <h2>A year with Visible Long-Covid Tracking</h2>
    
      <p>This post dives into a year of tracking Long Covid symptoms and progress using the Visible app. Dr. Mowinckel, a quantitative scientist, shares their experience monitoring heart rate, heart rate variability (HRV), daily symptoms, and functional capacity using the app&rsquo;s features and the FUNCAP27 questionnaire. Discover how this data provides insights into pacing strategies, identifies potential warning signs like HRV spikes, and reveals meaningful clusters of interconnected symptoms and experiences. Explore the journey of living with and managing Long Covid through the lens of personal health data.</p>
    
    <div class="uk-flex uk-flex-between uk-flex-middle ">
      
        <a class="btn-more" href="https://drmowinckels.io/blog/2025/visible/">
          Read
        </a>
      
    
      
        <span class="uk-text-right">
          
           
            
                <div class="uk-label timeline-tags">r</div>
            
          
           
            
                <div class="uk-label timeline-tags">health-data</div>
            
          
           
            
                <div class="uk-label timeline-tags">longcovid</div>
            
          
        </span>
      
    </div>
  </div>
</div> 
                        </li>
                    
                </ul>
            
                <a class="uk-position-center-left uk-position-small slide-nav-primary" href uk-slidenav-previous uk-slider-item="previous"></a>
                <a class="uk-position-center-right uk-position-small slide-nav-primary" href uk-slidenav-next uk-slider-item="next"></a>
            
            </div>
        </div>
    </div>
    
        <div class="uk-container uk-margin-top">
            <script src="https://giscus.app/client.js"
                data-repo=DrMowinckels/drmowinckels.github.io
                data-repo-id=MDEwOlJlcG9zaXRvcnkxMjM0NzEwMTI&#61;
                data-category=Comments
                data-category-id=DIC_kwDOB1wEpM4CAG0c
                data-mapping=pathname
                data-reactions-enabled=1
                data-emit-metadata=0
                data-theme=light
                data-lang=en
                crossorigin="anonymous"
                async>
            </script>
</div>

    

        </div><div class="section uk-section uk-padding-remove-vertical uk-margin">
    <div class="banner footer" height="500px">
        <div class="uk-container">
            <div class="uk-grid" uk-grid>
                <div class="uk-width-1-2@m">
                    
                      <h3><i class="fa-regular fa-copyright"></i> 2023 Athanasia Mo Mowinckel</h3>
                      <p></p>
                    
                  </div>
              <div class="uk-width-1-2@m">
                
              </div>
            </div>
          </div>
          <div class="footer-title uk-text-right">
            <h1>Dr. Mowinckel&rsquo;s</h1>
        </div>
    </div>
</div>


  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script>

</body>
</html>
