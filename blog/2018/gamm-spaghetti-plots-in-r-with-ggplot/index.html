<!DOCTYPE html>
<html lang="en">
    <head>
        
            <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">

<title>
Gamm Spaghetti Plots in R With Ggplot - Dr. Mowinckel&rsquo;s
</title>



            <meta property="og:title" content="GAMM spaghetti plots in R with ggplot - Dr. Mowinckel&rsquo;s" />
<meta property="og:type" content="website" />
<meta property="og:description" content=""/>
<meta property="og:url" content="https://drmowinckels.io/blog/2018/gamm-spaghetti-plots-in-r-with-ggplot/"/>
<meta property="og:site_name" content="Dr. Mowinckel&rsquo;s"/>



<meta property="og:image" content="https://drmowinckels.io/blog/2018/gamm-spaghetti-plots-in-r-with-ggplot/index_files/figure-html/plotGam1-1.png"/>

<meta property="og:image" content="https://drmowinckels.io/blog/2018/gamm-spaghetti-plots-in-r-with-ggplot/index_files/figure-html/plotGam2-1.png"/>

<meta property="og:image" content="https://drmowinckels.io/blog/2018/gamm-spaghetti-plots-in-r-with-ggplot/index_files/figure-html/plotGam3-1.png"/>

<meta property="og:image" content="https://drmowinckels.io/blog/2018/gamm-spaghetti-plots-in-r-with-ggplot/index_files/figure-html/unnamed-chunk-1-1.png"/>

<meta property="og:image" content="https://drmowinckels.io/blog/2018/gamm-spaghetti-plots-in-r-with-ggplot/index_files/figure-html/unnamed-chunk-2-1.png"/>



            
<link rel="shortcut icon" href="https://drmowinckels.io/img/fav.ico.png">


            


  
  
  
  <link rel="stylesheet" href="https://drmowinckels.io/css/main.min.8235b6920080e0a7f838f3272dcefed35808d4bd218e9f51f867612e95cab156.css" integrity="sha256-gjW2kgCA4Kf4OPMnLc7&#43;01gI1L0hjp9R&#43;GdhLpXKsVY=" crossorigin="anonymous" media="screen">




    <link rel="stylesheet" href="https://drmowinckels.io/css/syntax.css" integrity="" crossorigin="anonymous" media="screen">
    <link rel="stylesheet" href="https://drmowinckels.io/css/custom-style.css" integrity="" crossorigin="anonymous" media="screen">
        
        
        
        
    </head>
    <body> 
        <section id="top" class="section">
            
            <div class="container hero  fade-in one " style="background-image: url(/img/logo_large.svg);">
                
                

<h1 class="bold-title is-1">Blog</h1>


            </div>
            
            <div class="section  fade-in two ">
                
<div class="container">
    <hr>
    <nav class="navbar" role="navigation" aria-label="main navigation">
        
        <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false" >
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
        <div class="navbar-menu " id="navMenu">
            
            
                
                    
                        <a class="navbar-item" href="https://drmowinckels.io/">
                            
                            Home
                            
                        </a>
                    
                
                    
                        <a class="navbar-item" href="https://drmowinckels.io/about">
                            
                            About
                            
                        </a>
                    
                
                    
                        <a class="navbar-item" href="https://drmowinckels.io/#blog">
                            
                            Blog
                            
                        </a>
                    
                
                    
                        <a class="navbar-item" href="https://drmowinckels.io/#contact">
                            
                            Contact
                            
                        </a>
                    
                
            
        </div>
    </nav>
    <hr>
</div>



                
<div class="container">
    <h2 class="title is-1 top-pad strong-post-title">
        <a href="https://drmowinckels.io/blog/2018/gamm-spaghetti-plots-in-r-with-ggplot/">GAMM spaghetti plots in R with ggplot</a>
    </h2>
    <div class="post-data">
        Mar 8, 2018 |
        10 minutes read
    </div>
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
      
     <p>
         Tags:
          
           <a href="https://drmowinckels.io/tags/r">
             R</a>,
         
           <a href="https://drmowinckels.io/tags/gamm">
             GAMM</a>
         
        </p>
      
    
      
    

    
</div>

<div class="container markdown top-pad">
    <p>Here we go! Stepping into the world of blogging through R and blogdown! This is both super exciting and slightly scary, I have not really shared code online like I plan here before. But I guess we start somewhere. And we start with plotting.</p>
<p>A co-worker was working on some generalized additive mixed models (GAMM) through the R package <a href="https://cran.r-project.org/web/packages/mgcv/mgcv.pdf">mgcv</a>. The analyses work very well, and results were as expected. There were also some built in plotting functions for the gamm output in R. However, they were with base-r, and we all know base-r is not the most beautiful plotting application. Also, we have a need to a spaghetti plot in the background, as the whole point with a GAMM is that we have repeated data, and showing those in the background is very essential. <strong>This</strong> is not easily done in base-r.</p>
<p>This is what we have</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">);</span> <span class="nf">library</span><span class="p">(</span><span class="n">mgcv</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>## ── Attaching packages ──────────────────────────────────────────────────── tidyverse 1.3.0 ──
</code></pre><pre tabindex="0"><code>## ✓ ggplot2 3.3.0     ✓ purrr   0.3.4
## ✓ tibble  3.0.1     ✓ dplyr   0.8.5
## ✓ tidyr   1.0.3     ✓ stringr 1.4.0
## ✓ readr   1.3.1     ✓ forcats 0.5.0
</code></pre><pre tabindex="0"><code>## ── Conflicts ─────────────────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
</code></pre><pre tabindex="0"><code>## Loading required package: nlme
</code></pre><pre tabindex="0"><code>## 
## Attaching package: &#39;nlme&#39;
</code></pre><pre tabindex="0"><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     collapse
</code></pre><pre tabindex="0"><code>## This is mgcv 1.8-31. For overview type &#39;help(&#34;mgcv-package&#34;)&#39;.
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">set.seed</span><span class="p">(</span><span class="m">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">n.g</span> <span class="o">&lt;-</span> <span class="m">10</span>
</span></span><span class="line"><span class="cl"><span class="n">n</span><span class="o">&lt;-</span><span class="n">n.g</span><span class="o">*</span><span class="m">10</span><span class="o">*</span><span class="m">4</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dat</span> <span class="o">&lt;-</span> <span class="nf">gamSim</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>## Gu &amp; Wahba 4 term additive model
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">f</span> <span class="o">&lt;-</span> <span class="n">dat</span><span class="o">$</span><span class="n">f</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">## simulate nested random effects....</span>
</span></span><span class="line"><span class="cl"><span class="n">fa</span> <span class="o">&lt;-</span> <span class="nf">as.factor</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span><span class="nf">rep</span><span class="p">(</span><span class="m">4</span><span class="o">*</span><span class="n">n.g</span><span class="p">,</span><span class="m">10</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="n">ra</span> <span class="o">&lt;-</span> <span class="nf">rep</span><span class="p">(</span><span class="nf">rnorm</span><span class="p">(</span><span class="m">10</span><span class="p">),</span><span class="nf">rep</span><span class="p">(</span><span class="m">4</span><span class="o">*</span><span class="n">n.g</span><span class="p">,</span><span class="m">10</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">fb</span> <span class="o">&lt;-</span> <span class="nf">as.factor</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span><span class="nf">rep</span><span class="p">(</span><span class="n">n.g</span><span class="p">,</span><span class="m">4</span><span class="p">)),</span><span class="m">10</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">rb</span> <span class="o">&lt;-</span> <span class="nf">rep</span><span class="p">(</span><span class="nf">rnorm</span><span class="p">(</span><span class="m">4</span><span class="p">),</span><span class="nf">rep</span><span class="p">(</span><span class="n">n.g</span><span class="p">,</span><span class="m">4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nf">for </span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="m">1</span><span class="o">:</span><span class="m">9</span><span class="p">)</span> <span class="n">rb</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">rb</span><span class="p">,</span><span class="nf">rep</span><span class="p">(</span><span class="nf">rnorm</span><span class="p">(</span><span class="m">4</span><span class="p">),</span><span class="nf">rep</span><span class="p">(</span><span class="n">n.g</span><span class="p">,</span><span class="m">4</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">## simulate auto-correlated errors within groups</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span><span class="o">&lt;-</span><span class="nf">array</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">for </span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="m">1</span><span class="o">:</span><span class="m">40</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">eg</span> <span class="o">&lt;-</span> <span class="nf">rnorm</span><span class="p">(</span><span class="n">n.g</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="nf">sd</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="nf">for </span><span class="p">(</span><span class="n">j</span> <span class="n">in</span> <span class="m">2</span><span class="o">:</span><span class="n">n.g</span><span class="p">)</span> <span class="n">eg[j]</span> <span class="o">&lt;-</span> <span class="n">eg[j</span><span class="m">-1</span><span class="n">]</span><span class="o">*</span><span class="m">0.6</span><span class="o">+</span> <span class="n">eg[j]</span>
</span></span><span class="line"><span class="cl">  <span class="n">e</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">eg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dat</span><span class="o">$</span><span class="n">y</span> <span class="o">&lt;-</span> <span class="n">f</span> <span class="o">+</span> <span class="n">ra</span> <span class="o">+</span> <span class="n">rb</span> <span class="o">+</span> <span class="n">e</span>
</span></span><span class="line"><span class="cl"><span class="n">dat</span><span class="o">$</span><span class="n">id</span> <span class="o">&lt;-</span> <span class="n">fa</span><span class="p">;</span><span class="n">dat</span><span class="o">$</span><span class="n">fb</span> <span class="o">&lt;-</span> <span class="n">fb</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Let&#39;s have a look at it</span>
</span></span><span class="line"><span class="cl"><span class="n">dat</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">))</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">geom_line</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">.3</span><span class="p">,</span><span class="nf">aes</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">id</span><span class="p">))</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">.3</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_smooth</span><span class="p">()</span>
</span></span></code></pre></div><pre tabindex="0"><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
</code></pre><p><img src="index_files/figure-html/unnamed-chunk-1-1.png" alt=""><!-- --></p>
<p>The data is not particularly well crafted, but it serves to make my point I believe. <code>geom_smooth</code> runs a loess model for prediction, which, given this data, makes a lot of sense. But it&rsquo;s not what I want, and it won&rsquo;t take into account the repeated measures. Let&rsquo;s go over to the gamm models. I&rsquo;ll omit gam, because you can easily get gams in ggplot by running:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">dat</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">))</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">geom_line</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">.3</span><span class="p">,</span><span class="nf">aes</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">id</span><span class="p">))</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">.3</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s">&#34;gam&#34;</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>## `geom_smooth()` using formula &#39;y ~ s(x, bs = &#34;cs&#34;)&#39;
</code></pre><p><img src="index_files/figure-html/plotGam1-1.png" alt=""><!-- --></p>
<p>but that&rsquo;s definately not what we want, despite the horrible data</p>
<p>We could even give it a formula, which might look really nice. Not that the formula will read x and y in the formula as the &lsquo;x&rsquo; and &lsquo;y&rsquo; set in the <code>aes</code>. So don&rsquo;t give it the actual names of the column, use &lsquo;x&rsquo; and &lsquo;y&rsquo;.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">dat</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">))</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">geom_line</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">.3</span><span class="p">,</span><span class="nf">aes</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">id</span><span class="p">))</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">.3</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s">&#34;gam&#34;</span><span class="p">,</span> <span class="n">formula</span><span class="o">=</span><span class="n">y</span><span class="o">~</span><span class="nf">s</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">bs</span><span class="o">=</span><span class="s">&#39;cr&#39;</span><span class="p">))</span>
</span></span></code></pre></div><p><img src="index_files/figure-html/plotGam2-1.png" alt=""><!-- --></p>
<p>The downside to this is that it is only modelling the one term, and we want a fit that takes into account all our covariates, but only plots the one prediction, holding the others constant. trying to increase formula complexity in ggplot directly wont work, it&rsquo;s just not made for something so complex.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">dat</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">))</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">geom_line</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">.3</span><span class="p">,</span><span class="nf">aes</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">id</span><span class="p">))</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">.3</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s">&#34;gam&#34;</span><span class="p">,</span> <span class="n">formula</span><span class="o">=</span><span class="n">y</span><span class="o">~</span><span class="nf">s</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">bs</span><span class="o">=</span><span class="s">&#39;cr&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">s</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">bs</span><span class="o">=</span><span class="s">&#34;re&#34;</span><span class="p">))</span>
</span></span></code></pre></div><pre tabindex="0"><code>## Warning in predict.gam(model, newdata = data_frame(x = xseq), se.fit = se, : not all required variables have been supplied in  newdata!
</code></pre><pre tabindex="0"><code>## Warning: Computation failed in `stat_smooth()`:
## object &#39;group&#39; not found
</code></pre><p><img src="index_files/figure-html/plotGam3-1.png" alt=""><!-- --></p>
<p>So, let&rsquo;s have a look at what we want to model. This particular example is compelx, because it is the complex that is hard to predict and plot. The simple ones will work with the above, provigin a formula directly to <code>geom_stat</code>. We&rsquo;re using three smoothing splines on three predictors in this model, and including two random intercepts. But we are really only interested in the <code>x2</code> smoothing spline, the others are just covariates of no interest.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="nf">gamm</span><span class="p">(</span><span class="n">y</span><span class="o">~</span><span class="nf">s</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">bs</span><span class="o">=</span><span class="s">&#34;cr&#34;</span><span class="p">)</span><span class="o">+</span><span class="nf">s</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">bs</span><span class="o">=</span><span class="s">&#34;cr&#34;</span><span class="p">)</span><span class="o">+</span><span class="nf">s</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">bs</span><span class="o">=</span><span class="s">&#34;cr&#34;</span><span class="p">)</span><span class="o">+</span>
</span></span><span class="line"><span class="cl">           <span class="nf">s</span><span class="p">(</span><span class="n">x3</span><span class="p">,</span><span class="n">bs</span><span class="o">=</span><span class="s">&#34;cr&#34;</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="n">dat</span><span class="p">,</span><span class="n">random</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">id</span><span class="o">=~</span><span class="m">1</span><span class="p">,</span><span class="n">fb</span><span class="o">=~</span><span class="m">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">         <span class="n">correlation</span><span class="o">=</span><span class="nf">corAR1</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Output is a list of two</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">%&gt;%</span> <span class="nf">summary</span><span class="p">()</span>
</span></span></code></pre></div><pre tabindex="0"><code>##     Length Class Mode
## lme 18     lme   list
## gam 31     gam   list
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Let&#39;s see the model summary</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span><span class="o">$</span><span class="n">gam</span> <span class="o">%&gt;%</span> <span class="nf">summary</span><span class="p">()</span>
</span></span></code></pre></div><pre tabindex="0"><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## y ~ s(x0, bs = &#34;cr&#34;) + s(x1, bs = &#34;cr&#34;) + s(x2, bs = &#34;cr&#34;) + 
##     s(x3, bs = &#34;cr&#34;)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   7.6878     0.5131   14.98   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##         edf Ref.df      F p-value    
## s(x0) 2.760  2.760  5.136 0.00925 ** 
## s(x1) 1.938  1.938 61.438 &lt; 2e-16 ***
## s(x2) 7.059  7.059 42.398 &lt; 2e-16 ***
## s(x3) 1.000  1.000  0.185 0.66755    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.351   
##   Scale est. = 13.963    n = 400
</code></pre><p>So I went googling, and in my frustration, there was very little help in what I found. <code>mgcv</code>&rsquo;s gamm output is different from other analyses, as it gives a list containing an lme and gam model (which is really a GAMM model). So grabbing the smooth directly in ggplot will not work. Furthermore, we want one single smoothed predictor while still taking into account the rest of the predictors and covariates.</p>
<p>I even <a href="https://stackoverflow.com/questions/48907493/ggplot2-geom-ribbon-from-mgcvgamm/48907846?noredirect=1#comment85066362_48907846">posted something on stackoverflow</a> (the example data is horrendous!), and the answer pointed me to <code>predict()</code>. So that&rsquo; what I did, I tried running <code>predict()</code> on the gamm output, but the resulting output was not what I wanted. <code>predict()</code> predicts based on all the predictors and covariates, and so, we are not plotting the one smoothed predictor, but a jumble of predictors. The resulting &lsquo;smooth&rsquo; it not pretty, and completely wrong.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">pred</span> <span class="o">&lt;-</span> <span class="nf">predict</span><span class="p">(</span><span class="n">b</span><span class="o">$</span><span class="n">gam</span><span class="p">,</span> <span class="n">se.fit</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dat</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">))</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">geom_line</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">.3</span><span class="p">,</span><span class="nf">aes</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">id</span><span class="p">))</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">.3</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_ribbon</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">pred</span><span class="o">$</span><span class="n">fit</span><span class="m">-1.96</span><span class="o">*</span><span class="n">pred</span><span class="o">$</span><span class="n">se.fit</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="n">ymax</span><span class="o">=</span><span class="n">pred</span><span class="o">$</span><span class="n">fit</span><span class="m">+1.96</span><span class="o">*</span><span class="n">pred</span><span class="o">$</span><span class="n">se.fit</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s">&#34;red&#34;</span><span class="p">)</span><span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_line</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">pred</span><span class="o">$</span><span class="n">fit</span><span class="p">),</span> <span class="n">col</span><span class="o">=</span><span class="s">&#34;blue&#34;</span><span class="p">,</span> <span class="n">lwd</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="index_files/figure-html/unnamed-chunk-2-1.png" alt=""><!-- --></p>
<p>Now, there are packages to help do this. For instance, visreg has a gamm plotting function. However, <a href="https://cran.r-project.org/web/packages/visreg/visreg.pdf">visreg</a> requires attached data, or each variable existing in the global environment. I don&rsquo;t like working with attached data, in my opinion in makes the workflow less transparent, and it&rsquo;s hard to debug issues. If you forget to detach the data, you can spend hours trying to figure out why things aren&rsquo;t working, without noticing that the attached data may be messing things up.</p>
<p>What we need to do, is predict all the data, keeping the other covariates constant, while only varying the predictor of interest. Right-o. If you&rsquo;re good at simulating data etc, this might be easy for you. I&rsquo;m pretty terrible at it (for lack of practise for sure).</p>
<p>After trying for several days, without managing to make the plot I wanted, I tweeted my frustration.</p>
<!--html_preserve--><blockquote class="twitter-tweet"><p lang="en" dir="ltr">my inability to plot partial predictions of <a href="https://twitter.com/hashtag/gamm?src=hash&amp;ref_src=twsrc%5Etfw">#gamm</a> models in <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> <a href="https://twitter.com/hashtag/ggplot?src=hash&amp;ref_src=twsrc%5Etfw">#ggplot</a> after 2 days of googling, stackoverflow and constant coding is infuriatingly frustrating! I&#39;m not used to not grasping plotting!</p>&mdash; Athanasia Mo Mowinckel @Drmowinckels@fosstodon.org (@DrMowinckels) <a href="https://twitter.com/DrMowinckels/status/968428248026832896?ref_src=twsrc%5Etfw">February 27, 2018</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


<!--/html_preserve-->
<p>And to the rescue comes twitter, a useR pointed me to <a href="https://cran.r-project.org/web/packages/itsadug/index.html">itsadug</a>. The obscure package I just could not manage to find through all my googling. <code>itsadug</code> has a predict function, where you can specify which predictor you want to predict on.</p>
<p>If you give it the min, max and length of what you want to predict, it then generates data with all other predictors set to constants, for your convenient plotting. It was like magic, exactly what i was searching for. Now, I could plot what I wanted, just like I wanted it!</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">itsadug</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>## Loading required package: plotfunctions
</code></pre><pre tabindex="0"><code>## 
## Attaching package: &#39;plotfunctions&#39;
</code></pre><pre tabindex="0"><code>## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     alpha
</code></pre><pre tabindex="0"><code>## Loaded package itsadug 2.4 (see &#39;help(&#34;itsadug&#34;)&#39; ).
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># predict on x2</span>
</span></span><span class="line"><span class="cl"><span class="n">pred</span> <span class="o">=</span> <span class="nf">get_predictions</span><span class="p">(</span><span class="n">b</span><span class="o">$</span><span class="n">gam</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                       <span class="n">cond</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">x2</span> <span class="o">=</span> <span class="nf">seq</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="n">dat</span><span class="o">$</span><span class="n">x2</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="bp">T</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                                            <span class="nf">max</span><span class="p">(</span><span class="n">dat</span><span class="o">$</span><span class="n">x2</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="bp">T</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">                                            <span class="n">length.out</span> <span class="o">=</span> <span class="nf">nrow</span><span class="p">(</span><span class="n">dat</span><span class="p">)),</span> <span class="n">se</span><span class="o">=</span><span class="bp">T</span><span class="p">))</span>
</span></span></code></pre></div><pre tabindex="0"><code>## Summary:
## 	* x0 : numeric predictor; set to the value(s): 0.476351245073602. 
## 	* x1 : numeric predictor; set to the value(s): 0.514732652809471. 
## 	* x2 : numeric predictor; with 400 values ranging from 0.001315 to 0.999931. 
## 	* x3 : numeric predictor; set to the value(s): 0.477402933407575. 
## 	* NOTE : No random effects in the model to cancel.
## 
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># add y to predicted data, becasue ggplot requires all main variables in both datasets</span>
</span></span><span class="line"><span class="cl"><span class="n">pred</span> <span class="o">=</span> <span class="n">pred</span> <span class="o">%&gt;%</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dat</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">))</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">geom_line</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">.3</span><span class="p">,</span><span class="nf">aes</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">id</span><span class="p">))</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">.3</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_ribbon</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pred</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="m">.4</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">fit</span><span class="o">-</span><span class="n">CI</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">fit</span><span class="o">+</span><span class="n">CI</span><span class="p">),</span> <span class="n">show.legend</span> <span class="o">=</span> <span class="bp">F</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s">&#39;forestgreen&#39;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_line</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pred</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">fit</span><span class="p">),</span> <span class="n">show.legend</span> <span class="o">=</span> <span class="bp">F</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;forestgreen&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="index_files/figure-html/unnamed-chunk-3-1.png" alt=""><!-- --></p>
<p>That&rsquo;s looking much nicer! Hurrah! I also made a convenience function for my self, to make the predicted data. This would only work for other numeric predictors, and it&rsquo;s not particularly pretty coding, as it&rsquo;s using ugly eval parsing, but that&rsquo;s how I got it working for me.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Custom function that predicts on a single predictor, and adds the dependent with the value of 1</span>
</span></span><span class="line"><span class="cl"><span class="n">GammPredData</span> <span class="o">=</span> <span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">gamm.model</span><span class="p">,</span> <span class="n">condition</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="nf">eval</span><span class="p">(</span><span class="nf">parse</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nf">paste0</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;get_predictions(gamm.model, cond = list(&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">condition</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;=seq(min(data[condition], na.rm=T),max(data[condition], na.rm=T), length.out = nrow(data)))) %&gt;% as.data.frame() %&gt;% mutate(&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nf">str_split</span><span class="p">(</span><span class="n">gamm.model</span><span class="o">$</span><span class="n">formula</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">)</span><span class="n">[[2]]</span><span class="p">,</span><span class="s">&#34;=1)&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Use the function to predict on x2. you can easily supply the other predictors</span>
</span></span><span class="line"><span class="cl">  <span class="n">pred</span> <span class="o">=</span> <span class="nf">GammPredData</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="n">b</span><span class="o">$</span><span class="n">gam</span><span class="p">,</span> <span class="s">&#34;x2&#34;</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>## Summary:
## 	* x0 : numeric predictor; set to the value(s): 0.476351245073602. 
## 	* x1 : numeric predictor; set to the value(s): 0.514732652809471. 
## 	* x2 : numeric predictor; with 400 values ranging from 0.001315 to 0.999931. 
## 	* x3 : numeric predictor; set to the value(s): 0.477402933407575. 
## 	* NOTE : No random effects in the model to cancel.
## 
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">dat</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">))</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">geom_line</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">.3</span><span class="p">,</span><span class="nf">aes</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">id</span><span class="p">))</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">.3</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_ribbon</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pred</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="m">.4</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">fit</span><span class="o">-</span><span class="n">CI</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">fit</span><span class="o">+</span><span class="n">CI</span><span class="p">),</span> <span class="n">show.legend</span> <span class="o">=</span> <span class="bp">F</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s">&#39;forestgreen&#39;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_line</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pred</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">fit</span><span class="p">),</span> <span class="n">show.legend</span> <span class="o">=</span> <span class="bp">F</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;forestgreen&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="index_files/figure-html/unnamed-chunk-4-1.png" alt=""><!-- --></p>
<p>You might want to grab each predictor and plot them? That can be done also, and I&rsquo;ll use a combination of <code>apply</code>&lsquo;es to do so, for convenience. I love apply&rsquo;es&hellip;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Predictions</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;x0&#34;</span><span class="p">,</span> <span class="s">&#34;x1&#34;</span><span class="p">,</span> <span class="s">&#34;x2&#34;</span><span class="p">,</span><span class="s">&#34;x3&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># we will be using facet_wrap, gather the data on the predictors, for a long data frame.</span>
</span></span><span class="line"><span class="cl"><span class="n">dat2</span> <span class="o">=</span> <span class="n">dat</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">gather</span><span class="p">(</span><span class="n">Pred</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>## Note: Using an external vector in selections is ambiguous.
## ℹ Use `all_of(p)` instead of `p` to silence this message.
## ℹ See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.
## This message is displayed once per session.
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">preds</span> <span class="o">=</span> <span class="nf">list</span><span class="p">()</span> <span class="c1"># prepare a list</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># loop through the predictors</span>
</span></span><span class="line"><span class="cl"><span class="nf">for</span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">p</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">  <span class="n">preds[[i]]</span> <span class="o">=</span> <span class="nf">GammPredData</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="n">b</span><span class="o">$</span><span class="n">gam</span><span class="p">,</span> <span class="n">p[i]</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">    <span class="nf">select_</span><span class="p">(</span><span class="s">&#34;y&#34;</span><span class="p">,</span> <span class="s">&#34;CI&#34;</span><span class="p">,</span> <span class="s">&#34;fit&#34;</span><span class="p">,</span> <span class="n">p[i]</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">names</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span><span class="n">[i]</span> <span class="o">=</span> <span class="n">p[i]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><pre tabindex="0"><code>## Summary:
## 	* x0 : numeric predictor; with 400 values ranging from 0.013078 to 0.996077. 
## 	* x1 : numeric predictor; set to the value(s): 0.514732652809471. 
## 	* x2 : numeric predictor; set to the value(s): 0.445692849811167. 
## 	* x3 : numeric predictor; set to the value(s): 0.477402933407575. 
## 	* NOTE : No random effects in the model to cancel.
## 
</code></pre><pre tabindex="0"><code>## Warning: select_() is deprecated. 
## Please use select() instead
## 
## The &#39;programming&#39; vignette or the tidyeval book can help you
## to program with select() : https://tidyeval.tidyverse.org
## This warning is displayed once per session.
</code></pre><pre tabindex="0"><code>## Summary:
## 	* x0 : numeric predictor; set to the value(s): 0.476351245073602. 
## 	* x1 : numeric predictor; with 400 values ranging from 0.001837 to 0.999455. 
## 	* x2 : numeric predictor; set to the value(s): 0.445692849811167. 
## 	* x3 : numeric predictor; set to the value(s): 0.477402933407575. 
## 	* NOTE : No random effects in the model to cancel.
##  
## Summary:
## 	* x0 : numeric predictor; set to the value(s): 0.476351245073602. 
## 	* x1 : numeric predictor; set to the value(s): 0.514732652809471. 
## 	* x2 : numeric predictor; with 400 values ranging from 0.001315 to 0.999931. 
## 	* x3 : numeric predictor; set to the value(s): 0.477402933407575. 
## 	* NOTE : No random effects in the model to cancel.
##  
## Summary:
## 	* x0 : numeric predictor; set to the value(s): 0.476351245073602. 
## 	* x1 : numeric predictor; set to the value(s): 0.514732652809471. 
## 	* x2 : numeric predictor; set to the value(s): 0.445692849811167. 
## 	* x3 : numeric predictor; with 400 values ranging from 0.001642 to 0.996272. 
## 	* NOTE : No random effects in the model to cancel.
## 
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># use bind_rows to make them into a large data frame, gather them, just like the data</span>
</span></span><span class="line"><span class="cl"><span class="n">preds</span> <span class="o">=</span> <span class="nf">bind_rows</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span><span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">gather</span><span class="p">(</span><span class="n">Pred</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">na.omit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dat2</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">))</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">geom_line</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">.3</span><span class="p">,</span><span class="nf">aes</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">id</span><span class="p">))</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">.3</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_ribbon</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">preds</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="m">.4</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">fit</span><span class="o">-</span><span class="n">CI</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">fit</span><span class="o">+</span><span class="n">CI</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">Pred</span><span class="p">),</span> <span class="n">show.legend</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_line</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">preds</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">fit</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">Pred</span><span class="p">),</span> <span class="n">show.legend</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">Pred</span><span class="p">,</span> <span class="n">scales</span><span class="o">=</span><span class="s">&#34;free&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="index_files/figure-html/unnamed-chunk-5-1.png" alt=""><!-- --></p>
<p>And that is it. My first blogpost, and I hope it is to some help.</p>
<p>Happy International Woman&rsquo;s day!</p>


    
    <h3>Citation</h3>
    <div class="columns">
      <div class="column is-half">
        For attribution, please cite this work as
        <div class="highlight" style="border: 1px solid grey">
          <p style="padding: 1em;font-family: 'monospace">
            Dr. Mowinckel (Mar 8, 2018) GAMM spaghetti plots in R with ggplot. Retrieved from https://drmowinckels.io/blog/2018/gamm-spaghetti-plots-in-r-with-ggplot/
          </p>
        </div>
      </div>
      <div class="column is-half">
        <b>BibTeX citation</b>
        <div class="highlight" style="border: 1px solid grey">
          <p style="padding: 1em;font-family: 'monospace">
            @misc{ 2018-gamm-spaghetti-plots-in-r-with-ggplot,<br>
            &emsp;author = { Dr. Mowinckel },<br>
            &emsp;title = { GAMM spaghetti plots in R with ggplot },<br>
            &emsp;url = { https://drmowinckels.io/blog/2018/gamm-spaghetti-plots-in-r-with-ggplot/ },<br>
            &emsp;year = { 2018 }<br>
            &emsp;updated = { Nov 7, 2023 }<br>
            }
          </p>
        </div>
      </div>
    </div>
  

</div>


<div class="container giscus my-4">
    <script src="https://giscus.app/client.js"
        data-repo=DrMowinckels/DrMowinckels.github.io
        data-repo-id=MDEwOlJlcG9zaXRvcnkxMjM0NzEwMTI&#61;
        data-category=Comments
        data-category-id=DIC_kwDOB1wEpM4CAG0c
        data-mapping=pathname
        data-reactions-enabled=1
        data-emit-metadata=0
        data-theme=light
        data-lang=en
        crossorigin="anonymous"
        async>
    </script>
</div>



                
                <div class="container">
    <hr>
</div>
<div class="container has-text-centered top-pad">
    <a href="#top">
        <i class="fa fa-arrow-up"></i>
    </a>
</div>

<div class="container">
    <hr>
</div>

                <div class="section" id="footer">
    <div class="container has-text-centered">
    
        <span class="footer-text">
            Athanasia Monika Mowinckel <i class="fab fa-creative-commons" aria-hidden="true"></i>-<i class="fab fa-creative-commons-by"></i>-<i class="fab fa-creative-commons-sa"></i>-2020. Feeding to <a href="https://rweekly.org'">R weekly</a>. View source code on <a href="https://github.com/Athanasiamo/DrMowinckels"><i class="fab fa-github"></i></a>.
        </span>
    
    </div>
</div>

                
            </div>
        </section>
        
        


<script src="https://drmowinckels.io/js/bundle.5c23c0437f001a469ca373a465a6f7487203d18e10cdff76d86a60af66d5ee28.js" integrity="sha256-XCPAQ38AGkaco3OkZab3SHID0Y4Qzf922Gpgr2bV7ig=" crossorigin="anonymous">></script>




<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-115545202-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>








  <script defer data-domain=drmowinckels.io src="https://plausible.io/js/plausible.js"></script>






        
        
        
        
    </body>
</html>
