<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, shrink-to-fit=no"
/>


<title>GAMM spaghetti plots in R with ggplot - Dr. Mowinckel&#39;s</title>


<meta name="hugo-igloo" />




  <meta name="description" content="A co-worker was working on some generalized additive mixed models (GAMM) through the R package [mgcv] The analyses work very well, and results were as expected . There were also some built in plotting functions for the gamm output in R . However, they were with base-r, and we all know base r is not the most beautiful ." />
  <meta name="author" content="Dr. Mowinckel" />






<meta name="generator" content="Hugo 0.119.0">



        

<meta prefix="og: http://ogp.me/ns#" property="og:url" content="https://drmowinckels.io/">
<meta prefix="og: http://ogp.me/ns#" property="og:type" content="website">
<meta prefix="og: http://ogp.me/ns#" property="og:title" content="GAMM spaghetti plots in R with ggplot - Dr. Mowinckel&rsquo;s">
<meta prefix="og: http://ogp.me/ns#" property="og:description" content="A co-worker was working on some generalized additive mixed models (GAMM) through the R package [mgcv] The analyses work very well, and results were as expected . There were also some built in plotting functions for the gamm output in R . However, they were with base-r, and we all know base r is not the most beautiful .">


<meta name="twitter:card" content="summary_large_image">
<meta property="twitter:domain" content="https://drmowinckels.io/">
<meta name="twitter:title" content="Igloo">
<meta name="twitter:description" content="A co-worker was working on some generalized additive mixed models (GAMM) through the R package [mgcv] The analyses work very well, and results were as expected . There were also some built in plotting functions for the gamm output in R . However, they were with base-r, and we all know base r is not the most beautiful .">



    <meta prefix="og: http://ogp.me/ns#" property="og:image" content="https://drmowinckels.io/blog/2018/gamm-spaghetti-plots-in-r-with-ggplot/index_files/figure-html/unnamed-chunk-4-1.png" />
    <meta name="twitter:image" content="https://drmowinckels.io/blog/2018/gamm-spaghetti-plots-in-r-with-ggplot/index_files/figure-html/unnamed-chunk-4-1.png">



        
  





    



 

    <link rel="stylesheet" href="https://drmowinckels.io/bundle.min.b949f82ef13ab020c09cc9a01a06b5c35de205c6382cde6ed472ebf5efc8e9d2.css" 
    integrity="sha256-uUn4LvE6sCDAnMmgGga1w13iBcY4LN5u1HLr9e/I6dI=" 
    crossorigin="anonymous">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" crossorigin="anonymous">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/night-owl.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>



    <script src="https://drmowinckels.io/uikit/dist/js/uikit.min.js"></script>


    <script src="https://drmowinckels.io/uikit/dist/js/uikit-icons.min.js"></script>



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha384-k6Rqe5g0pSv8V0e6fFfFjW1y77vKTjkE1IUaB+MHUO2GtODX6azbMqa6Y53/zJTU" crossorigin="anonymous">

        



    

    
    
    
    <link
        rel="icon"
        href="https://drmowinckels.io/img/fav.ico_hu5c0771520169a7c5939dfeb49415bb9c_5256_16x0_resize_box_3.png"
        sizes="16x16"
        type="image/png"
    />
    
    
    
        
        <link rel="shortcut icon" href="https://drmowinckels.io/favicon.ico" type="image/x-icon">
    
    <link
        rel="icon"
        href="https://drmowinckels.io/img/fav.ico_hu5c0771520169a7c5939dfeb49415bb9c_5256_32x0_resize_box_3.png"
        sizes="32x32"
        type="image/png"
    />
    
    
    
    <link
        rel="icon"
        href="https://drmowinckels.io/img/fav.ico_hu5c0771520169a7c5939dfeb49415bb9c_5256_57x0_resize_box_3.png"
        sizes="57x57"
        type="image/png"
    />
    
    
    
    <link
        rel="icon"
        href="https://drmowinckels.io/img/fav.ico_hu5c0771520169a7c5939dfeb49415bb9c_5256_76x0_resize_box_3.png"
        sizes="76x76"
        type="image/png"
    />
    
    
    
    <link
        rel="icon"
        href="https://drmowinckels.io/img/fav.ico_hu5c0771520169a7c5939dfeb49415bb9c_5256_96x0_resize_box_3.png"
        sizes="96x96"
        type="image/png"
    />
    
    
    
    <link
        rel="icon"
        href="https://drmowinckels.io/img/fav.ico_hu5c0771520169a7c5939dfeb49415bb9c_5256_128x0_resize_box_3.png"
        sizes="128x128"
        type="image/png"
    />
    
    
    
    <link
        rel="apple-touch-icon"
        href="https://drmowinckels.io/img/fav.ico_hu5c0771520169a7c5939dfeb49415bb9c_5256_120x0_resize_box_3.png"
        sizes="120x120"
        type="image/png"
    />
    
    
    
    <link
        rel="icon"
        href="https://drmowinckels.io/img/fav.ico_hu5c0771520169a7c5939dfeb49415bb9c_5256_150x0_resize_box_3.png"
        sizes="150x150"
        type="image/png"
    />
    
    
    
    <link
        rel="apple-touch-icon"
        href="https://drmowinckels.io/img/fav.ico_hu5c0771520169a7c5939dfeb49415bb9c_5256_152x0_resize_box_3.png"
        sizes="152x152"
        type="image/png"
    />
    
    
    
        <meta name="msapplication-TileImage" 
            content="/img/fav.ico_hu5c0771520169a7c5939dfeb49415bb9c_5256_144x0_resize_box_3.png">
    
    <link
        rel="icon"
        href="https://drmowinckels.io/img/fav.ico_hu5c0771520169a7c5939dfeb49415bb9c_5256_144x0_resize_box_3.png"
        sizes="144x144"
        type="image/png"
    />
    
    
    
    <link
        rel="apple-touch-icon"
        href="https://drmowinckels.io/img/fav.ico_hu5c0771520169a7c5939dfeb49415bb9c_5256_180x0_resize_box_3.png"
        sizes="180x180"
        type="image/png"
    />
    
    
    
    <link
        rel="icon"
        href="https://drmowinckels.io/img/fav.ico_hu5c0771520169a7c5939dfeb49415bb9c_5256_192x0_resize_box_3.png"
        sizes="192x192"
        type="image/png"
    />
    
    
    
    <link
        rel="shortcut icon"
        href="https://drmowinckels.io/img/fav.ico_hu5c0771520169a7c5939dfeb49415bb9c_5256_196x0_resize_box_3.png"
        sizes="196x196"
        type="image/png"
    />
<meta name="msapplication-TileColor" content="#198c8c">
<meta name="theme-color" content="#198c8c"> 
<meta name="msapplication-TileColor" content="#198c8c">

    </head>
    <body>
            
<div class="banner ">
    
        <div class="uk-container uk-container-small banner-top">
            <h1>blog</h1>
        </div>
    
</div>

        



<div id="smallnav" uk-offcanvas="flip: true" class="uk-offcanvas">
    <div class="uk-offcanvas-bar">
        <ul class="uk-nav">
            
                <a class="uk-navbar-item uk-logo" href="https://drmowinckels.io/">
                    <img src="https://drmowinckels.io/img/logo.png" width="40">
                </a> 
            
            
                <li>
                    <a href="https://drmowinckels.io/about">
                        About
                        
                    </a>
                    
                </li>
            
                <li>
                    <a href="https://drmowinckels.io/blog">
                        Blog
                        
                    </a>
                    
                </li>
            
                <li>
                    <a href="https://drmowinckels.io/talks">
                        Talks
                        
                    </a>
                    
                </li>
            
                <li>
                    <a href="https://drmowinckels.io/projects">
                        Projects
                        
                    </a>
                    
                </li>
            
        </ul>
    </div>
</div>
<a class="uk-navbar-container uk-navbar-left uk-navbar-toggle uk-hidden@s" uk-toggle="target: #smallnav" uk-navbar-toggle-icon></a>

<div class="uk-visible@s" uk-sticky="sel-target: .uk-navbar-container; cls-active: uk-navbar-sticky">
    <nav class="uk-navbar-container">   
        <div uk-navbar>     
            <div class="uk-navbar-center">
                
                    
                        <div class="uk-navbar-center-left">
                            <ul class="uk-navbar-nav">
                    
                    
                    <li>
                        <a href="https://drmowinckels.io/about">
                            About
                            
                        </a>
                        
                    </li>
                    
                
                    
                    
                    <li>
                        <a href="https://drmowinckels.io/blog">
                            Blog
                            
                        </a>
                        
                    </li>
                    
                            </ul>
                        </div>
                    
                
                    
                    
                        
                            <a class="uk-navbar-item uk-logo" href="https://drmowinckels.io/">
                                <img src="https://drmowinckels.io/img/logo.png" width="40">
                            </a> 
                        
                        <div class="uk-navbar-center-right">
                            <ul class="uk-navbar-nav"> 
                    
                    <li>
                        <a href="https://drmowinckels.io/talks">
                            Talks
                            
                        </a>
                        
                    </li>
                    
                
                    
                    
                    <li>
                        <a href="https://drmowinckels.io/projects">
                            Projects
                            
                        </a>
                        
                    </li>
                    
                            </ul>
                        </div>
                    
                
            </div>
        </div>
    </nav>
</div>


        <div id="content" class="uk-container uk-container-small uk-margin-large-top">
    <article class="uk-article">
        <div class="uk-grid uk-flex-top" uk-grid>
            
            
            <div class="uk-width-1-4@s">
              <img src="https://drmowinckels.io/blog/2018/gamm-spaghetti-plots-in-r-with-ggplot/index_files/figure-html/unnamed-chunk-4-1.png" alt="GAMM spaghetti plots in R with ggplot" class="uk-border-rounded">
              
            </div>

        <div class="uk-width-3-4@s">
        <h1 class="uk-article-title">GAMM spaghetti plots in R with ggplot</h1>
        
        <div class="uk-border-top uk-article-meta uk-flex uk-flex-center uk-flex-between">
            <h3 class="uk-margin-top-small">
                Mar 8, 2018
            </h3>
            

            
                <div class="uk-flex uk-flex-wrap uk-flex-right">
                    
                        
                        
                        
                        
                        
                        <div class="uk-card uk-margin-left uk-margin-bottom">
                            <a href="https://drmowinckels.io/tags/r/" class="uk-label uk-label-secondary tags" >
                                R
                            </a>
                        </div>
                    
                        
                        
                        
                        
                        
                        <div class="uk-card uk-margin-left uk-margin-bottom">
                            <a href="https://drmowinckels.io/tags/gamm/" class="uk-label uk-label-secondary tags" >
                                GAMM
                            </a>
                        </div>
                    
                </div>
            
        </div>
    </div>
        <div id="offcanvas-reveal" uk-offcanvas="mode: reveal; overlay: true">
            <div class="uk-offcanvas-bar">
                <button class="uk-offcanvas-close" type="button" uk-close></button>
                <h3>Table of Content</h3>
                <nav id="TableOfContents"></nav>
            </div>
        </div>
        
            <p class="uk-text-lead">A co-worker was working on some generalized additive mixed models (GAMM) through the R package [mgcv] The analyses work very well, and results were as expected . There were also some built in plotting functions for the gamm output in R . However, they were with base-r, and we all know base r is not the most beautiful .</p>
        
        <div class="uk-markdown uk-width">
            <p>Here we go! Stepping into the world of blogging through R and blogdown! This is both super exciting and slightly scary, I have not really shared code online like I plan here before. But I guess we start somewhere. And we start with plotting.</p>
<p>A co-worker was working on some generalized additive mixed models (GAMM) through the R package <a href="https://cran.r-project.org/web/packages/mgcv/mgcv.pdf">mgcv</a>. The analyses work very well, and results were as expected. There were also some built in plotting functions for the gamm output in R. However, they were with base-r, and we all know base-r is not the most beautiful plotting application. Also, we have a need to a spaghetti plot in the background, as the whole point with a GAMM is that we have repeated data, and showing those in the background is very essential. <strong>This</strong> is not easily done in base-r.</p>
<p>This is what we have</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(tidyverse); <span style="color:#a6e22e">library</span>(mgcv)
</span></span></code></pre></div><pre tabindex="0"><code>## ── Attaching packages ──────────────────────────────────────────────────── tidyverse 1.3.0 ──
</code></pre><pre tabindex="0"><code>## ✓ ggplot2 3.3.0     ✓ purrr   0.3.4
## ✓ tibble  3.0.1     ✓ dplyr   0.8.5
## ✓ tidyr   1.0.3     ✓ stringr 1.4.0
## ✓ readr   1.3.1     ✓ forcats 0.5.0
</code></pre><pre tabindex="0"><code>## ── Conflicts ─────────────────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
</code></pre><pre tabindex="0"><code>## Loading required package: nlme
</code></pre><pre tabindex="0"><code>## 
## Attaching package: &#39;nlme&#39;
</code></pre><pre tabindex="0"><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     collapse
</code></pre><pre tabindex="0"><code>## This is mgcv 1.8-31. For overview type &#39;help(&#34;mgcv-package&#34;)&#39;.
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">set.seed</span>(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>n.g <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>n<span style="color:#f92672">&lt;-</span>n.g<span style="color:#f92672">*</span><span style="color:#ae81ff">10</span><span style="color:#f92672">*</span><span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dat <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">gamSim</span>(<span style="color:#ae81ff">1</span>,n<span style="color:#f92672">=</span>n,scale<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
</span></span></code></pre></div><pre tabindex="0"><code>## Gu &amp; Wahba 4 term additive model
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>f <span style="color:#f92672">&lt;-</span> dat<span style="color:#f92672">$</span>f
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## simulate nested random effects....</span>
</span></span><span style="display:flex;"><span>fa <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.factor</span>(<span style="color:#a6e22e">rep</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>,<span style="color:#a6e22e">rep</span>(<span style="color:#ae81ff">4</span><span style="color:#f92672">*</span>n.g,<span style="color:#ae81ff">10</span>)))
</span></span><span style="display:flex;"><span>ra <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rep</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">10</span>),<span style="color:#a6e22e">rep</span>(<span style="color:#ae81ff">4</span><span style="color:#f92672">*</span>n.g,<span style="color:#ae81ff">10</span>))
</span></span><span style="display:flex;"><span>fb <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.factor</span>(<span style="color:#a6e22e">rep</span>(<span style="color:#a6e22e">rep</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">4</span>,<span style="color:#a6e22e">rep</span>(n.g,<span style="color:#ae81ff">4</span>)),<span style="color:#ae81ff">10</span>))
</span></span><span style="display:flex;"><span>rb <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rep</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">4</span>),<span style="color:#a6e22e">rep</span>(n.g,<span style="color:#ae81ff">4</span>))
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">for </span>(i in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">9</span>) rb <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(rb,<span style="color:#a6e22e">rep</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">4</span>),<span style="color:#a6e22e">rep</span>(n.g,<span style="color:#ae81ff">4</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## simulate auto-correlated errors within groups</span>
</span></span><span style="display:flex;"><span>e<span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">array</span>(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">for </span>(i in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">40</span>) {
</span></span><span style="display:flex;"><span>  eg <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rnorm</span>(n.g, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">sd</span>(f))
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">for </span>(j in <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span>n.g) eg[j] <span style="color:#f92672">&lt;-</span> eg[j<span style="color:#ae81ff">-1</span>]<span style="color:#f92672">*</span><span style="color:#ae81ff">0.6</span><span style="color:#f92672">+</span> eg[j]
</span></span><span style="display:flex;"><span>  e<span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">c</span>(e,eg)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dat<span style="color:#f92672">$</span>y <span style="color:#f92672">&lt;-</span> f <span style="color:#f92672">+</span> ra <span style="color:#f92672">+</span> rb <span style="color:#f92672">+</span> e
</span></span><span style="display:flex;"><span>dat<span style="color:#f92672">$</span>id <span style="color:#f92672">&lt;-</span> fa;dat<span style="color:#f92672">$</span>fb <span style="color:#f92672">&lt;-</span> fb
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># Let&#39;s have a look at it</span>
</span></span><span style="display:flex;"><span>dat <span style="color:#f92672">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>x2, y<span style="color:#f92672">=</span>y)) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_line</span>(alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">.3</span>,<span style="color:#a6e22e">aes</span>(group<span style="color:#f92672">=</span>id)) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_point</span>(alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">.3</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_smooth</span>()
</span></span></code></pre></div><pre tabindex="0"><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
</code></pre><p><img src="index_files/figure-html/unnamed-chunk-1-1.png" alt=""><!-- --></p>
<p>The data is not particularly well crafted, but it serves to make my point I believe. <code>geom_smooth</code> runs a loess model for prediction, which, given this data, makes a lot of sense. But it&rsquo;s not what I want, and it won&rsquo;t take into account the repeated measures. Let&rsquo;s go over to the gamm models. I&rsquo;ll omit gam, because you can easily get gams in ggplot by running:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>dat <span style="color:#f92672">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>x2, y<span style="color:#f92672">=</span>y)) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_line</span>(alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">.3</span>,<span style="color:#a6e22e">aes</span>(group<span style="color:#f92672">=</span>id)) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_point</span>(alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">.3</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_smooth</span>(method<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;gam&#34;</span>)
</span></span></code></pre></div><pre tabindex="0"><code>## `geom_smooth()` using formula &#39;y ~ s(x, bs = &#34;cs&#34;)&#39;
</code></pre><p><img src="index_files/figure-html/plotGam1-1.png" alt=""><!-- --></p>
<p>but that&rsquo;s definately not what we want, despite the horrible data</p>
<p>We could even give it a formula, which might look really nice. Not that the formula will read x and y in the formula as the &lsquo;x&rsquo; and &lsquo;y&rsquo; set in the <code>aes</code>. So don&rsquo;t give it the actual names of the column, use &lsquo;x&rsquo; and &lsquo;y&rsquo;.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>dat <span style="color:#f92672">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>x2, y<span style="color:#f92672">=</span>y)) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_line</span>(alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">.3</span>,<span style="color:#a6e22e">aes</span>(group<span style="color:#f92672">=</span>id)) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_point</span>(alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">.3</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_smooth</span>(method<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;gam&#34;</span>, formula<span style="color:#f92672">=</span>y<span style="color:#f92672">~</span><span style="color:#a6e22e">s</span>(x,bs<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;cr&#39;</span>))
</span></span></code></pre></div><p><img src="index_files/figure-html/plotGam2-1.png" alt=""><!-- --></p>
<p>The downside to this is that it is only modelling the one term, and we want a fit that takes into account all our covariates, but only plots the one prediction, holding the others constant. trying to increase formula complexity in ggplot directly wont work, it&rsquo;s just not made for something so complex.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>dat <span style="color:#f92672">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>x2, y<span style="color:#f92672">=</span>y)) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_line</span>(alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">.3</span>,<span style="color:#a6e22e">aes</span>(group<span style="color:#f92672">=</span>id)) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_point</span>(alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">.3</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_smooth</span>(method<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;gam&#34;</span>, formula<span style="color:#f92672">=</span>y<span style="color:#f92672">~</span><span style="color:#a6e22e">s</span>(x,bs<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;cr&#39;</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">s</span>(group, bs<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;re&#34;</span>))
</span></span></code></pre></div><pre tabindex="0"><code>## Warning in predict.gam(model, newdata = data_frame(x = xseq), se.fit = se, : not all required variables have been supplied in  newdata!
</code></pre><pre tabindex="0"><code>## Warning: Computation failed in `stat_smooth()`:
## object &#39;group&#39; not found
</code></pre><p><img src="index_files/figure-html/plotGam3-1.png" alt=""><!-- --></p>
<p>So, let&rsquo;s have a look at what we want to model. This particular example is compelx, because it is the complex that is hard to predict and plot. The simple ones will work with the above, provigin a formula directly to <code>geom_stat</code>. We&rsquo;re using three smoothing splines on three predictors in this model, and including two random intercepts. But we are really only interested in the <code>x2</code> smoothing spline, the others are just covariates of no interest.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>b <span style="color:#f92672">=</span> <span style="color:#a6e22e">gamm</span>(y<span style="color:#f92672">~</span><span style="color:#a6e22e">s</span>(x0,bs<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;cr&#34;</span>)<span style="color:#f92672">+</span><span style="color:#a6e22e">s</span>(x1,bs<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;cr&#34;</span>)<span style="color:#f92672">+</span><span style="color:#a6e22e">s</span>(x2,bs<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;cr&#34;</span>)<span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>           <span style="color:#a6e22e">s</span>(x3,bs<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;cr&#34;</span>),data<span style="color:#f92672">=</span>dat,random<span style="color:#f92672">=</span><span style="color:#a6e22e">list</span>(id<span style="color:#f92672">=~</span><span style="color:#ae81ff">1</span>,fb<span style="color:#f92672">=~</span><span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>         correlation<span style="color:#f92672">=</span><span style="color:#a6e22e">corAR1</span>())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Output is a list of two</span>
</span></span><span style="display:flex;"><span>b <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">summary</span>()
</span></span></code></pre></div><pre tabindex="0"><code>##     Length Class Mode
## lme 18     lme   list
## gam 31     gam   list
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># Let&#39;s see the model summary</span>
</span></span><span style="display:flex;"><span>b<span style="color:#f92672">$</span>gam <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">summary</span>()
</span></span></code></pre></div><pre tabindex="0"><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## y ~ s(x0, bs = &#34;cr&#34;) + s(x1, bs = &#34;cr&#34;) + s(x2, bs = &#34;cr&#34;) + 
##     s(x3, bs = &#34;cr&#34;)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   7.6878     0.5131   14.98   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##         edf Ref.df      F p-value    
## s(x0) 2.760  2.760  5.136 0.00925 ** 
## s(x1) 1.938  1.938 61.438 &lt; 2e-16 ***
## s(x2) 7.059  7.059 42.398 &lt; 2e-16 ***
## s(x3) 1.000  1.000  0.185 0.66755    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.351   
##   Scale est. = 13.963    n = 400
</code></pre><p>So I went googling, and in my frustration, there was very little help in what I found. <code>mgcv</code>&rsquo;s gamm output is different from other analyses, as it gives a list containing an lme and gam model (which is really a GAMM model). So grabbing the smooth directly in ggplot will not work. Furthermore, we want one single smoothed predictor while still taking into account the rest of the predictors and covariates.</p>
<p>I even <a href="https://stackoverflow.com/questions/48907493/ggplot2-geom-ribbon-from-mgcvgamm/48907846?noredirect=1#comment85066362_48907846">posted something on stackoverflow</a> (the example data is horrendous!), and the answer pointed me to <code>predict()</code>. So that&rsquo; what I did, I tried running <code>predict()</code> on the gamm output, but the resulting output was not what I wanted. <code>predict()</code> predicts based on all the predictors and covariates, and so, we are not plotting the one smoothed predictor, but a jumble of predictors. The resulting &lsquo;smooth&rsquo; it not pretty, and completely wrong.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>pred <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">predict</span>(b<span style="color:#f92672">$</span>gam, se.fit<span style="color:#f92672">=</span>T)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dat <span style="color:#f92672">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>x2, y<span style="color:#f92672">=</span>y)) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_line</span>(alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">.3</span>,<span style="color:#a6e22e">aes</span>(group<span style="color:#f92672">=</span>id)) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_point</span>(alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">.3</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_ribbon</span>(<span style="color:#a6e22e">aes</span>(ymin<span style="color:#f92672">=</span>pred<span style="color:#f92672">$</span>fit<span style="color:#ae81ff">-1.96</span><span style="color:#f92672">*</span>pred<span style="color:#f92672">$</span>se.fit,
</span></span><span style="display:flex;"><span>                  ymax<span style="color:#f92672">=</span>pred<span style="color:#f92672">$</span>fit<span style="color:#ae81ff">+1.96</span><span style="color:#f92672">*</span>pred<span style="color:#f92672">$</span>se.fit), alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.2</span>, fill<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;red&#34;</span>)<span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_line</span>(<span style="color:#a6e22e">aes</span>(y<span style="color:#f92672">=</span>pred<span style="color:#f92672">$</span>fit), col<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;blue&#34;</span>, lwd<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span></code></pre></div><p><img src="index_files/figure-html/unnamed-chunk-2-1.png" alt=""><!-- --></p>
<p>Now, there are packages to help do this. For instance, visreg has a gamm plotting function. However, <a href="https://cran.r-project.org/web/packages/visreg/visreg.pdf">visreg</a> requires attached data, or each variable existing in the global environment. I don&rsquo;t like working with attached data, in my opinion in makes the workflow less transparent, and it&rsquo;s hard to debug issues. If you forget to detach the data, you can spend hours trying to figure out why things aren&rsquo;t working, without noticing that the attached data may be messing things up.</p>
<p>What we need to do, is predict all the data, keeping the other covariates constant, while only varying the predictor of interest. Right-o. If you&rsquo;re good at simulating data etc, this might be easy for you. I&rsquo;m pretty terrible at it (for lack of practise for sure).</p>
<p>After trying for several days, without managing to make the plot I wanted, I tweeted my frustration.</p>
<!--html_preserve--><blockquote class="twitter-tweet"><p lang="en" dir="ltr">my inability to plot partial predictions of <a href="https://twitter.com/hashtag/gamm?src=hash&amp;ref_src=twsrc%5Etfw">#gamm</a> models in <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> <a href="https://twitter.com/hashtag/ggplot?src=hash&amp;ref_src=twsrc%5Etfw">#ggplot</a> after 2 days of googling, stackoverflow and constant coding is infuriatingly frustrating! I&#39;m not used to not grasping plotting!</p>&mdash; Athanasia Mo Mowinckel @Drmowinckels@fosstodon.org (@DrMowinckels) <a href="https://twitter.com/DrMowinckels/status/968428248026832896?ref_src=twsrc%5Etfw">February 27, 2018</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


<!--/html_preserve-->
<p>And to the rescue comes twitter, a useR pointed me to <a href="https://cran.r-project.org/web/packages/itsadug/index.html">itsadug</a>. The obscure package I just could not manage to find through all my googling. <code>itsadug</code> has a predict function, where you can specify which predictor you want to predict on.</p>
<p>If you give it the min, max and length of what you want to predict, it then generates data with all other predictors set to constants, for your convenient plotting. It was like magic, exactly what i was searching for. Now, I could plot what I wanted, just like I wanted it!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(itsadug)
</span></span></code></pre></div><pre tabindex="0"><code>## Loading required package: plotfunctions
</code></pre><pre tabindex="0"><code>## 
## Attaching package: &#39;plotfunctions&#39;
</code></pre><pre tabindex="0"><code>## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     alpha
</code></pre><pre tabindex="0"><code>## Loaded package itsadug 2.4 (see &#39;help(&#34;itsadug&#34;)&#39; ).
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># predict on x2</span>
</span></span><span style="display:flex;"><span>pred <span style="color:#f92672">=</span> <span style="color:#a6e22e">get_predictions</span>(b<span style="color:#f92672">$</span>gam, 
</span></span><span style="display:flex;"><span>                       cond <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(x2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">seq</span>(<span style="color:#a6e22e">min</span>(dat<span style="color:#f92672">$</span>x2, na.rm<span style="color:#f92672">=</span>T),
</span></span><span style="display:flex;"><span>                                            <span style="color:#a6e22e">max</span>(dat<span style="color:#f92672">$</span>x2, na.rm<span style="color:#f92672">=</span>T), 
</span></span><span style="display:flex;"><span>                                            length.out <span style="color:#f92672">=</span> <span style="color:#a6e22e">nrow</span>(dat)), se<span style="color:#f92672">=</span>T))
</span></span></code></pre></div><pre tabindex="0"><code>## Summary:
## 	* x0 : numeric predictor; set to the value(s): 0.476351245073602. 
## 	* x1 : numeric predictor; set to the value(s): 0.514732652809471. 
## 	* x2 : numeric predictor; with 400 values ranging from 0.001315 to 0.999931. 
## 	* x3 : numeric predictor; set to the value(s): 0.477402933407575. 
## 	* NOTE : No random effects in the model to cancel.
## 
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># add y to predicted data, becasue ggplot requires all main variables in both datasets</span>
</span></span><span style="display:flex;"><span>pred <span style="color:#f92672">=</span> pred <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">mutate</span>(y<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dat <span style="color:#f92672">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>x2, y<span style="color:#f92672">=</span>y)) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_line</span>(alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">.3</span>,<span style="color:#a6e22e">aes</span>(group<span style="color:#f92672">=</span>id)) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_point</span>(alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">.3</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_ribbon</span>(data<span style="color:#f92672">=</span>pred, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">.4</span>, <span style="color:#a6e22e">aes</span>(ymin<span style="color:#f92672">=</span>fit<span style="color:#f92672">-</span>CI, ymax<span style="color:#f92672">=</span>fit<span style="color:#f92672">+</span>CI), show.legend <span style="color:#f92672">=</span> F, fill<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;forestgreen&#39;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_line</span>(data<span style="color:#f92672">=</span>pred, <span style="color:#a6e22e">aes</span>(y<span style="color:#f92672">=</span>fit), show.legend <span style="color:#f92672">=</span> F, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;forestgreen&#39;</span>)
</span></span></code></pre></div><p><img src="index_files/figure-html/unnamed-chunk-3-1.png" alt=""><!-- --></p>
<p>That&rsquo;s looking much nicer! Hurrah! I also made a convenience function for my self, to make the predicted data. This would only work for other numeric predictors, and it&rsquo;s not particularly pretty coding, as it&rsquo;s using ugly eval parsing, but that&rsquo;s how I got it working for me.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># Custom function that predicts on a single predictor, and adds the dependent with the value of 1</span>
</span></span><span style="display:flex;"><span>GammPredData <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(data, gamm.model, condition){
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">eval</span>(<span style="color:#a6e22e">parse</span>(text<span style="color:#f92672">=</span><span style="color:#a6e22e">paste0</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;get_predictions(gamm.model, cond = list(&#34;</span>,
</span></span><span style="display:flex;"><span>    condition,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;=seq(min(data[condition], na.rm=T),max(data[condition], na.rm=T), length.out = nrow(data)))) %&gt;% as.data.frame() %&gt;% mutate(&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">str_split</span>(gamm.model<span style="color:#f92672">$</span>formula, <span style="color:#e6db74">&#34; &#34;</span>)[[2]],<span style="color:#e6db74">&#34;=1)&#34;</span>)))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Use the function to predict on x2. you can easily supply the other predictors</span>
</span></span><span style="display:flex;"><span>  pred <span style="color:#f92672">=</span> <span style="color:#a6e22e">GammPredData</span>(dat, b<span style="color:#f92672">$</span>gam, <span style="color:#e6db74">&#34;x2&#34;</span>)
</span></span></code></pre></div><pre tabindex="0"><code>## Summary:
## 	* x0 : numeric predictor; set to the value(s): 0.476351245073602. 
## 	* x1 : numeric predictor; set to the value(s): 0.514732652809471. 
## 	* x2 : numeric predictor; with 400 values ranging from 0.001315 to 0.999931. 
## 	* x3 : numeric predictor; set to the value(s): 0.477402933407575. 
## 	* NOTE : No random effects in the model to cancel.
## 
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>dat <span style="color:#f92672">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>x2, y<span style="color:#f92672">=</span>y)) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_line</span>(alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">.3</span>,<span style="color:#a6e22e">aes</span>(group<span style="color:#f92672">=</span>id)) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_point</span>(alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">.3</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_ribbon</span>(data<span style="color:#f92672">=</span>pred, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">.4</span>, <span style="color:#a6e22e">aes</span>(ymin<span style="color:#f92672">=</span>fit<span style="color:#f92672">-</span>CI, ymax<span style="color:#f92672">=</span>fit<span style="color:#f92672">+</span>CI), show.legend <span style="color:#f92672">=</span> F, fill<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;forestgreen&#39;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_line</span>(data<span style="color:#f92672">=</span>pred, <span style="color:#a6e22e">aes</span>(y<span style="color:#f92672">=</span>fit), show.legend <span style="color:#f92672">=</span> F, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;forestgreen&#39;</span>)
</span></span></code></pre></div><p><img src="index_files/figure-html/unnamed-chunk-4-1.png" alt=""><!-- --></p>
<p>You might want to grab each predictor and plot them? That can be done also, and I&rsquo;ll use a combination of <code>apply</code>&lsquo;es to do so, for convenience. I love apply&rsquo;es&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># Predictions</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;x0&#34;</span>, <span style="color:#e6db74">&#34;x1&#34;</span>, <span style="color:#e6db74">&#34;x2&#34;</span>,<span style="color:#e6db74">&#34;x3&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># we will be using facet_wrap, gather the data on the predictors, for a long data frame.</span>
</span></span><span style="display:flex;"><span>dat2 <span style="color:#f92672">=</span> dat <span style="color:#f92672">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gather</span>(Pred, x, p)
</span></span></code></pre></div><pre tabindex="0"><code>## Note: Using an external vector in selections is ambiguous.
## ℹ Use `all_of(p)` instead of `p` to silence this message.
## ℹ See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.
## This message is displayed once per session.
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>preds <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>() <span style="color:#75715e"># prepare a list</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># loop through the predictors</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">for</span>(i in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">length</span>(p)){
</span></span><span style="display:flex;"><span>  preds[[i]] <span style="color:#f92672">=</span> <span style="color:#a6e22e">GammPredData</span>(dat, b<span style="color:#f92672">$</span>gam, p[i]) <span style="color:#f92672">%&gt;%</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">select_</span>(<span style="color:#e6db74">&#34;y&#34;</span>, <span style="color:#e6db74">&#34;CI&#34;</span>, <span style="color:#e6db74">&#34;fit&#34;</span>, p[i])
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">names</span>(preds)[i] <span style="color:#f92672">=</span> p[i]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><pre tabindex="0"><code>## Summary:
## 	* x0 : numeric predictor; with 400 values ranging from 0.013078 to 0.996077. 
## 	* x1 : numeric predictor; set to the value(s): 0.514732652809471. 
## 	* x2 : numeric predictor; set to the value(s): 0.445692849811167. 
## 	* x3 : numeric predictor; set to the value(s): 0.477402933407575. 
## 	* NOTE : No random effects in the model to cancel.
## 
</code></pre><pre tabindex="0"><code>## Warning: select_() is deprecated. 
## Please use select() instead
## 
## The &#39;programming&#39; vignette or the tidyeval book can help you
## to program with select() : https://tidyeval.tidyverse.org
## This warning is displayed once per session.
</code></pre><pre tabindex="0"><code>## Summary:
## 	* x0 : numeric predictor; set to the value(s): 0.476351245073602. 
## 	* x1 : numeric predictor; with 400 values ranging from 0.001837 to 0.999455. 
## 	* x2 : numeric predictor; set to the value(s): 0.445692849811167. 
## 	* x3 : numeric predictor; set to the value(s): 0.477402933407575. 
## 	* NOTE : No random effects in the model to cancel.
##  
## Summary:
## 	* x0 : numeric predictor; set to the value(s): 0.476351245073602. 
## 	* x1 : numeric predictor; set to the value(s): 0.514732652809471. 
## 	* x2 : numeric predictor; with 400 values ranging from 0.001315 to 0.999931. 
## 	* x3 : numeric predictor; set to the value(s): 0.477402933407575. 
## 	* NOTE : No random effects in the model to cancel.
##  
## Summary:
## 	* x0 : numeric predictor; set to the value(s): 0.476351245073602. 
## 	* x1 : numeric predictor; set to the value(s): 0.514732652809471. 
## 	* x2 : numeric predictor; set to the value(s): 0.445692849811167. 
## 	* x3 : numeric predictor; with 400 values ranging from 0.001642 to 0.996272. 
## 	* NOTE : No random effects in the model to cancel.
## 
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># use bind_rows to make them into a large data frame, gather them, just like the data</span>
</span></span><span style="display:flex;"><span>preds <span style="color:#f92672">=</span> <span style="color:#a6e22e">bind_rows</span>(preds)<span style="color:#f92672">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gather</span>(Pred, x, p) <span style="color:#f92672">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">na.omit</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dat2 <span style="color:#f92672">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(x<span style="color:#f92672">=</span>x, y<span style="color:#f92672">=</span>y)) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_line</span>(alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">.3</span>,<span style="color:#a6e22e">aes</span>(group<span style="color:#f92672">=</span>id)) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_point</span>(alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">.3</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_ribbon</span>(data<span style="color:#f92672">=</span>preds, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">.4</span>, <span style="color:#a6e22e">aes</span>(ymin<span style="color:#f92672">=</span>fit<span style="color:#f92672">-</span>CI, ymax<span style="color:#f92672">=</span>fit<span style="color:#f92672">+</span>CI, fill<span style="color:#f92672">=</span>Pred), show.legend <span style="color:#f92672">=</span> F) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_line</span>(data<span style="color:#f92672">=</span>preds, <span style="color:#a6e22e">aes</span>(y<span style="color:#f92672">=</span>fit, color<span style="color:#f92672">=</span>Pred), show.legend <span style="color:#f92672">=</span> F) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span>Pred, scales<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;free&#34;</span>)
</span></span></code></pre></div><p><img src="index_files/figure-html/unnamed-chunk-5-1.png" alt=""><!-- --></p>
<p>And that is it. My first blogpost, and I hope it is to some help.</p>
<p>Happy International Woman&rsquo;s day!</p>

        </div>
    </article><div class="uk-margin">
    <button  class="uk-button uk-button-default" uk-toggle="target: #citation; animation: uk-animation-fade" type="button">
        Cite me!
    </button>
    <div id="citation" hidden class="uk-margin">
        <div uk-grid class="uk-child-width-1-2@s">
            <div>
                For attribution, please cite this work as
                <div class="uk-card uk-card-default uk-card-bod uk-text-breaky">
                    Dr. Mowinckel 
                    (Mar 8, 2018) 
                    GAMM spaghetti plots in R with ggplot. 
                    Retrieved from https://drmowinckels.io/blog/2018/gamm-spaghetti-plots-in-r-with-ggplot/.
                     DOI: https://www.doi.org/10.5281/zenodo.13256467
                </div>
            </div>
            <div>
                <b>BibTeX citation</b>
                <div class="uk-card uk-card-default uk-card-body uk-text-break">
                    @misc{ <br>
                        2018-gamm-spaghetti-plots-in-r-with-ggplot,<br>
                        &emsp;author =  "Dr. Mowinckel",<br>
                        &emsp;title = "GAMM spaghetti plots in R with ggplot",<br>
                        &emsp;url = "https://drmowinckels.io/blog/2018/gamm-spaghetti-plots-in-r-with-ggplot/",<br>
                        &emsp;year = 2018,<br>
                         &emsp;doi = "https://www.doi.org/10.5281/zenodo.13256467",<br> 
                        &emsp;updated = "Oct 7, 2024"<br>
                    }
                </div>
            </div>
        </div>
    </div>
</div><div class="uk-grid uk-child-width-expand@s uk-margin-top" uk-grid>
    <div class="uk-width-expand">
        
    </div>
    
    <div class="uk-width-auto">
        
            <a class="uk-button uk-button-default" href="https://drmowinckels.io/blog/2018/gamm-random-effects/">
                GAMM random effects
                <span class="uk-margin-small-right" uk-icon="chevron-double-right"></span>
            </a>
        
    </div>
</div>

    
    
        <div class="uk-container uk-margin-top">
            <script src="https://giscus.app/client.js"
                data-repo=DrMowinckels/drmowinckels.github.io
                data-repo-id=MDEwOlJlcG9zaXRvcnkxMjM0NzEwMTI&#61;
                data-category=Comments
                data-category-id=DIC_kwDOB1wEpM4CAG0c
                data-mapping=pathname
                data-reactions-enabled=1
                data-emit-metadata=0
                data-theme=light
                data-lang=en
                crossorigin="anonymous"
                async>
            </script>
</div>

    

        </div><div class="section uk-section uk-padding-remove-vertical uk-margin">
    <div class="banner footer" height="500px">
        <div class="uk-container">
            <div class="uk-grid" uk-grid>
                <div class="uk-width-1-2@m">
                    
                      <h3><i class="fa-regular fa-copyright"></i> 2023 Athanasia Mo Mowinckel</h3>
                      <p></p>
                    
                  </div>
              <div class="uk-width-1-2@m">
                
              </div>
            </div>
          </div>
          <div class="footer-title uk-text-right">
            <h1>Dr. Mowinckel&rsquo;s</h1>
        </div>
    </div>
</div>
</body>
</html>
