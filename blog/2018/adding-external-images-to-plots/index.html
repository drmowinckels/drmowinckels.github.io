<!DOCTYPE html>
<html lang="en">
    <head>
        
            <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">

<title>
Adding External Images to Plots - Dr. Mowinckel&rsquo;s
</title>



            <meta property="og:title" content="Adding external images to plots - Dr. Mowinckel&rsquo;s" />
<meta property="og:type" content="website" />
<meta property="og:description" content=""/>
<meta property="og:url" content="https://drmowinckels.io/blog/2018/adding-external-images-to-plots/"/>
<meta property="og:site_name" content="Dr. Mowinckel&rsquo;s"/>



<meta property="og:image" content="https://drmowinckels.io/blog/2018/adding-external-images-to-plots/brainSlices/single/0000_trans.png"/>

<meta property="og:image" content="https://drmowinckels.io/blog/2018/adding-external-images-to-plots/brainSlices/single/0001_trans.png"/>

<meta property="og:image" content="https://drmowinckels.io/blog/2018/adding-external-images-to-plots/brainSlices/single/0002_trans.png"/>

<meta property="og:image" content="https://drmowinckels.io/blog/2018/adding-external-images-to-plots/brainSlices/single/0003_trans.png"/>

<meta property="og:image" content="https://drmowinckels.io/blog/2018/adding-external-images-to-plots/brainSlices/single/0004_trans.png"/>



            
<link rel="shortcut icon" href="https://drmowinckels.io/img/fav.ico.png">


            


  
  
  
  <link rel="stylesheet" href="https://drmowinckels.io/css/main.min.8235b6920080e0a7f838f3272dcefed35808d4bd218e9f51f867612e95cab156.css" integrity="sha256-gjW2kgCA4Kf4OPMnLc7&#43;01gI1L0hjp9R&#43;GdhLpXKsVY=" crossorigin="anonymous" media="screen">




    <link rel="stylesheet" href="https://drmowinckels.io/css/syntax.css" integrity="" crossorigin="anonymous" media="screen">
    <link rel="stylesheet" href="https://drmowinckels.io/css/custom-style.css" integrity="" crossorigin="anonymous" media="screen">
        
        
        
        
    </head>
    <body> 
        <section id="top" class="section">
            
            <div class="container hero  fade-in one " style="background-image: url(/img/logo_large.svg);">
                
                

<h1 class="bold-title is-1">Blog</h1>


            </div>
            
            <div class="section  fade-in two ">
                
<div class="container">
    <hr>
    <nav class="navbar" role="navigation" aria-label="main navigation">
        
        <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false" >
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
        <div class="navbar-menu " id="navMenu">
            
            
                
                    
                        <a class="navbar-item" href="https://drmowinckels.io/">
                            
                            Home
                            
                        </a>
                    
                
                    
                        <a class="navbar-item" href="https://drmowinckels.io/about">
                            
                            About
                            
                        </a>
                    
                
                    
                        <a class="navbar-item" href="https://drmowinckels.io/#blog">
                            
                            Blog
                            
                        </a>
                    
                
                    
                        <a class="navbar-item" href="https://drmowinckels.io/#contact">
                            
                            Contact
                            
                        </a>
                    
                
            
        </div>
    </nav>
    <hr>
</div>



                
<div class="container">
    <h2 class="title is-1 top-pad strong-post-title">
        <a href="https://drmowinckels.io/blog/2018/adding-external-images-to-plots/">Adding external images to plots</a>
    </h2>
    <div class="post-data">
        May 7, 2018 |
        8 minutes read
    </div>
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
      
     <p>
         Tags:
          
           <a href="https://drmowinckels.io/tags/r">
             R</a>
         
        </p>
      
    
      
    

    
</div>

<div class="container markdown top-pad">
    <p>Two weeks ago we had out first RLadies-Oslo meetup! It was such a great turnout, and I had so much fun presenting to the group of lovely folks!</p>
<p>And indeed it is true, I love plotting. Probably more than I love analysing data (and definately more than cleaning and wrangling :P). I can spend hours and hours creating my own custom plotting functions for whatever paper/output I am currently working on. I&rsquo;m not sure if this is a productive way of spending my time, but it&rsquo;s fun and instantly grattifying.</p>
<p>Given that I&rsquo;m in neuroimaging, I actually quite often find myself in need of adding neuroimages (brains!) to my plots, to aid interpretation and the reader. Having the data plotted, with the brain images that correspond to the data, is a good way to showcase results, and make it easier both for me and my reader to understand what the findings are.</p>

<h4 id="when-wanting-to-add-external-images-to-plots-there-are-several-necessary-steps" class="anchor-link"><a href="#when-wanting-to-add-external-images-to-plots-there-are-several-necessary-steps">When wanting to add external images to plots, there are several necessary steps:</a></h4>
<ol>
<li>You need to create all the images you might want to add, place them in a folder, and give the images names (drop the whitespaces) that make sense according to the data you have.</li>
<li>The images <strong>might</strong> need to be processed to make plotting easier (i.e. them being the same size, backgrounds transparent etc.) I use <a href="https://www.imagemagick.org/script/index.php">ImageMagick</a> for this, but there are R-packages to help, like <a href="https://cran.r-project.org/web/packages/imager/vignettes/gettingstarted.html">imager</a></li>
<li>A clear idea of what you want to plot and why</li>
</ol>
<ul>
<li><strong>how</strong> comes with trial-and-error and perserverence (and hopefully with the help of this post)</li>
</ul>

<h2 id="the-data" class="anchor-link"><a href="#the-data">The Data</a></h2>
<p>All my images have been extracted with a neuroimaging analysis software I regularly use; <a href="">FSL</a>. FSL provides all brains on black backgrounds, which I have stripped so they are transparent, for nicer plotting. I&rsquo;ll leave out image manipulation from this post, I&rsquo;m planning something on that later.</p>
<p>I have all my images in a folder called <code>single</code> which is within a folder called <code>brainSlices</code>. First of all, we need to read in the paths for all the files we want to add, so having them stored all within a folder, with nice naming conventions, makes life easier. I&rsquo;ll place them all in a data.frame I&rsquo;ll call <code>DATA</code> in a columns names <code>images</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">DATA</span> <span class="o">=</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">images</span><span class="o">=</span><span class="nf">list.files</span><span class="p">(</span><span class="s">&#34;brainSlices/single&#34;</span><span class="p">,</span> <span class="n">full.names</span> <span class="o">=</span> <span class="bp">T</span><span class="p">),</span> <span class="n">stringsAsFactors</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">head</span><span class="p">(</span><span class="n">DATA</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>##                              images
## 1 brainSlices/single/0000_trans.png
## 2 brainSlices/single/0001_trans.png
## 3 brainSlices/single/0002_trans.png
## 4 brainSlices/single/0003_trans.png
## 5 brainSlices/single/0004_trans.png
## 6 brainSlices/single/0005_trans.png
</code></pre><p>My files a pretty simple, numbered images, corresponding to some brain network. Now that I have all the image file paths nicely stored, I&rsquo;ll also generate som decent names for the images, so that we an plot them with labels.</p>
<p>I&rsquo;ll strip the filepaths for everything that is <strong>not</strong> numeric, so I can have only the numbers (of course, these are so nicely ordered I could have generated a sequence of numbers).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">DATA</span><span class="o">$</span><span class="n">names</span> <span class="o">=</span> <span class="nf">gsub</span><span class="p">(</span><span class="s">&#34;[a-zA-Z]|[[:punct:]]&#34;</span><span class="p">,</span><span class="s">&#34;&#34;</span><span class="p">,</span><span class="n">DATA</span><span class="o">$</span><span class="n">images</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">head</span><span class="p">(</span><span class="n">DATA</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>##                              images names
## 1 brainSlices/single/0000_trans.png  0000
## 2 brainSlices/single/0001_trans.png  0001
## 3 brainSlices/single/0002_trans.png  0002
## 4 brainSlices/single/0003_trans.png  0003
## 5 brainSlices/single/0004_trans.png  0004
## 6 brainSlices/single/0005_trans.png  0005
</code></pre><p>We also generate some random values that we assign to the brain networks, so we have some values to plot!</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">DATA</span><span class="o">$</span><span class="n">values</span> <span class="o">=</span> <span class="nf">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nf">nrow</span><span class="p">(</span><span class="n">DATA</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nf">head</span><span class="p">(</span><span class="n">DATA</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>##                              images names values
## 1 brainSlices/single/0000_trans.png  0000     26
## 2 brainSlices/single/0001_trans.png  0001     43
## 3 brainSlices/single/0002_trans.png  0002     53
## 4 brainSlices/single/0003_trans.png  0003     69
## 5 brainSlices/single/0004_trans.png  0004     78
## 6 brainSlices/single/0005_trans.png  0005     86
</code></pre>
<h2 id="lets-do-some-plotting" class="anchor-link"><a href="#lets-do-some-plotting">Let&rsquo;s do some plotting!</a></h2>
<p>I always start out with what the data plot will look like first, then add inn the images last. This is the easiest process, in my opinion. So, we make a bar chart of the values for each network on the y-axis, and each network on the x-axis. We use the <code>stat=&quot;identity&quot;</code> option, because we want to plot the actual value provided on the y, not a count of the x-axis occurence, which is default bar chart behaviour.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">DATA</span><span class="p">)</span> <span class="o">+</span> <span class="nf">geom_histogram</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">names</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">values</span><span class="p">),</span> <span class="n">stat</span><span class="o">=</span><span class="s">&#34;identity&#34;</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>## Warning: Ignoring unknown parameters: binwidth, bins, pad
</code></pre><p><img src="index_files/figure-html/unnamed-chunk-5-1.png" alt=""><!-- --></p>
<p>That&rsquo;s a bar chart alright! Ok, let&rsquo;s increase complexity by adding <strong>one</strong> image to begin with. The function I use to add external images is <code>annotate_custom</code> which is the only ggplot function I have found that will do what I want. But first, we will need to actually read in the image from it&rsquo;s filepath, transform it into a graphics object <code>grob</code> within R, so that we may plot it. For this we need both the <code>png</code> and <code>grid</code> packages.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">png</span><span class="p">);</span> <span class="nf">library</span><span class="p">(</span><span class="n">grid</span><span class="p">);</span>
</span></span></code></pre></div><p>we read in the png from the first file into a variable.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">img</span> <span class="o">=</span> <span class="nf">readPNG</span><span class="p">(</span><span class="n">DATA</span><span class="o">$</span><span class="n">images[1]</span><span class="p">)</span>
</span></span></code></pre></div><p>And transform it into a graphics object (grob)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">g</span> <span class="o">=</span>  <span class="nf">rasterGrob</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
</span></span></code></pre></div><p>Now that it&rsquo;s a graphics object, we can place it in the plot. <code>annotate_custom</code> requires a placement of the object just like a rectangle would, <code>xmin</code>, <code>xmax</code>, <code>ymin</code> and <code>ymax</code>, this works well for us, as our images are rectangles (even with transparent backgrounds).</p>
<p>Given that this is a bar chart, where each element on the x is centered on an integer, I&rsquo;m using xmin and xmax on x -/+ 0.5, to get the image in the right spot. The y really depends on the aspect ratio of your image, trial-and-error is usually needed to get it in the right size.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">(</span><span class="n">DATA</span><span class="p">)</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">geom_histogram</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">names</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">values</span><span class="p">),</span> <span class="n">stat</span><span class="o">=</span><span class="s">&#34;identity&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">annotation_custom</span><span class="p">(</span><span class="n">grob</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="m">.5</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="m">1.5</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="m">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="m">10</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>## Warning: Ignoring unknown parameters: binwidth, bins, pad
</code></pre><p><img src="index_files/figure-html/unnamed-chunk-9-1.png" alt=""><!-- -->
Whoop! Brain in plot! Now, let&rsquo;s get them all in there! I do this in for loops, because I just don&rsquo;t know any other way to do it. If you do, post me a comment. I&rsquo;ll be so thankful for a more elegant solution!</p>
<p>Untill then, let&rsquo;s get for-looping.
First, save the base plot to an object in your environment, one of the lovely things with ggplot it the possibility to incrementally add elements to it.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">PLOT</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">DATA</span><span class="p">)</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">geom_histogram</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">names</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">values</span><span class="p">),</span> <span class="n">stat</span><span class="o">=</span><span class="s">&#34;identity&#34;</span><span class="p">)</span> 
</span></span></code></pre></div><pre tabindex="0"><code>## Warning: Ignoring unknown parameters: binwidth, bins, pad
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">g</span> <span class="o">=</span> <span class="nf">list</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nf">for</span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="m">1</span><span class="o">:</span><span class="nf">nrow</span><span class="p">(</span><span class="n">DATA</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">  <span class="n">img</span> <span class="o">=</span> <span class="nf">readPNG</span><span class="p">(</span><span class="n">DATA</span><span class="o">$</span><span class="n">images[i]</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">g[[i]]</span> <span class="o">=</span>  <span class="nf">rasterGrob</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="n">PLOT</span> <span class="o">=</span> <span class="n">PLOT</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">    <span class="nf">annotation_custom</span><span class="p">(</span><span class="n">grob</span><span class="o">=</span><span class="n">g[[i]]</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="n">i</span><span class="m">-.5</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">i</span><span class="m">+.5</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="m">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="m">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">PLOT</span>
</span></span></code></pre></div><p><img src="index_files/figure-html/unnamed-chunk-10-1.png" alt=""><!-- --></p>
<p>Whoop! More brains in plot! The axis text is a little hard to read, so we can angle it for better viewing. Which we can conveniently do with ggplots lovely theme operations.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">PLOT</span> <span class="o">+</span> <span class="nf">theme</span><span class="p">(</span><span class="n">axis.text.x</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="m">60</span><span class="p">,</span> <span class="n">vjust</span><span class="o">=</span><span class="m">-.001</span><span class="p">))</span>
</span></span></code></pre></div><p><img src="index_files/figure-html/unnamed-chunk-11-1.png" alt=""><!-- --></p>
<p>Unfortunately, some of our brains are in the foreground of their bar-top, and so the value is hard to see. We can try placing the brains on above the bars instead.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">PLOT</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">DATA</span><span class="p">)</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">geom_histogram</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">names</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">values</span><span class="p">),</span> <span class="n">stat</span><span class="o">=</span><span class="s">&#34;identity&#34;</span><span class="p">)</span> 
</span></span></code></pre></div><pre tabindex="0"><code>## Warning: Ignoring unknown parameters: binwidth, bins, pad
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">g</span> <span class="o">=</span> <span class="nf">list</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nf">for</span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="m">1</span><span class="o">:</span><span class="nf">nrow</span><span class="p">(</span><span class="n">DATA</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">  <span class="n">img</span> <span class="o">=</span> <span class="nf">readPNG</span><span class="p">(</span><span class="n">DATA</span><span class="o">$</span><span class="n">images[i]</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">g[[i]]</span> <span class="o">=</span>  <span class="nf">rasterGrob</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="n">PLOT</span> <span class="o">=</span> <span class="n">PLOT</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">    <span class="nf">annotation_custom</span><span class="p">(</span><span class="n">grob</span><span class="o">=</span><span class="n">g[[i]]</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="n">i</span><span class="m">-.5</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">i</span><span class="m">+.5</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">DATA</span><span class="o">$</span><span class="n">values[i]</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">DATA</span><span class="o">$</span><span class="n">values[i]</span><span class="m">+10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">PLOT</span> <span class="o">+</span> <span class="nf">theme</span><span class="p">(</span><span class="n">axis.text.x</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="m">60</span><span class="p">,</span> <span class="n">vjust</span><span class="o">=</span><span class="m">-.001</span><span class="p">))</span>
</span></span></code></pre></div><p><img src="index_files/figure-html/unnamed-chunk-12-1.png" alt=""><!-- --></p>
<p>That looks fun! It&rsquo;s like brains popping out of chimneys :D But some of the top brains are cropped. Poor brains! Easy enough to fix by scaling the Y, so that it doesn&rsquo;t stop at 100, but maybe 110.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">PLOT</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">theme</span><span class="p">(</span><span class="n">axis.text.x</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="m">60</span><span class="p">,</span> <span class="n">vjust</span><span class="o">=</span><span class="m">-.001</span><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">110</span><span class="p">))</span>
</span></span></code></pre></div><p><img src="index_files/figure-html/unnamed-chunk-13-1.png" alt=""><!-- --></p>
<p>Nice! I&rsquo;m pretty happy with that for a fun plot. But I wouldn&rsquo;t necessarily submit that to a fancy academic journal, where even colours are a stretch. For something like that, i&rsquo;d put the brains below the bars, which we can easily do!</p>
<p>In this case, I&rsquo;ll use ggplot built-in <code>Inf</code> notation, which gives you the edge of the plotting area. This is very convenient. <code>Inf</code> on the x-axis signifies the right-hand boundary, while <code>-Inf</code> is the left-hand one. For Y, they are the top and bottom, respectively. I only need to y in this case.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">PLOT</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">DATA</span><span class="p">)</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">geom_histogram</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">names</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">values</span><span class="p">),</span> <span class="n">stat</span><span class="o">=</span><span class="s">&#34;identity&#34;</span><span class="p">)</span> 
</span></span></code></pre></div><pre tabindex="0"><code>## Warning: Ignoring unknown parameters: binwidth, bins, pad
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">g</span> <span class="o">=</span> <span class="nf">list</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nf">for</span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="m">1</span><span class="o">:</span><span class="nf">nrow</span><span class="p">(</span><span class="n">DATA</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">  <span class="n">img</span> <span class="o">=</span> <span class="nf">readPNG</span><span class="p">(</span><span class="n">DATA</span><span class="o">$</span><span class="n">images[i]</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">g[[i]]</span> <span class="o">=</span>  <span class="nf">rasterGrob</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="n">PLOT</span> <span class="o">=</span> <span class="n">PLOT</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">    <span class="nf">annotation_custom</span><span class="p">(</span><span class="n">grob</span><span class="o">=</span><span class="n">g[[i]]</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="n">i</span><span class="m">-.5</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">i</span><span class="m">+.5</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=-</span><span class="kc">Inf</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="m">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">PLOT</span> <span class="o">+</span> <span class="nf">theme</span><span class="p">(</span><span class="n">axis.text.x</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="m">60</span><span class="p">,</span> <span class="n">vjust</span><span class="o">=</span><span class="m">-.001</span><span class="p">))</span>
</span></span></code></pre></div><p><img src="index_files/figure-html/unnamed-chunk-14-1.png" alt=""><!-- --></p>
<p>right-o! It&rsquo;s a little crowded though. Let&rsquo;s reduce the plot to the ones where the value exceeds 60, let&rsquo;s pretend that&rsquo;s some magic significance threshold.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>## ── Attaching packages ───────────────────────────────────────────────────── tidyverse 1.3.0 ──
</code></pre><pre tabindex="0"><code>## ✓ tibble  3.0.1     ✓ dplyr   0.8.5
## ✓ tidyr   1.0.3     ✓ stringr 1.4.0
## ✓ readr   1.3.1     ✓ forcats 0.5.0
## ✓ purrr   0.3.4
</code></pre><pre tabindex="0"><code>## ── Conflicts ──────────────────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">Data_reduced</span> <span class="o">=</span> <span class="n">DATA</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">values</span> <span class="o">&gt;=</span> <span class="m">60</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">PLOT</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">Data_reduced</span><span class="p">)</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">geom_histogram</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">names</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">values</span><span class="p">),</span> <span class="n">stat</span><span class="o">=</span><span class="s">&#34;identity&#34;</span><span class="p">)</span> 
</span></span></code></pre></div><pre tabindex="0"><code>## Warning: Ignoring unknown parameters: binwidth, bins, pad
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">g</span> <span class="o">=</span> <span class="nf">list</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nf">for</span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="m">1</span><span class="o">:</span><span class="nf">nrow</span><span class="p">(</span><span class="n">Data_reduced</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">  <span class="n">img</span> <span class="o">=</span> <span class="nf">readPNG</span><span class="p">(</span><span class="n">Data_reduced</span><span class="o">$</span><span class="n">images[i]</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">g[[i]]</span> <span class="o">=</span>  <span class="nf">rasterGrob</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="n">PLOT</span> <span class="o">=</span> <span class="n">PLOT</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">    <span class="nf">annotation_custom</span><span class="p">(</span><span class="n">grob</span><span class="o">=</span><span class="n">g[[i]]</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="n">i</span><span class="m">-.5</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">i</span><span class="m">+.5</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=-</span><span class="kc">Inf</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="m">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">PLOT</span> <span class="o">+</span> <span class="nf">theme</span><span class="p">(</span><span class="n">axis.text.x</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="m">60</span><span class="p">,</span> <span class="n">vjust</span><span class="o">=</span><span class="m">-.001</span><span class="p">))</span>
</span></span></code></pre></div><p><img src="index_files/figure-html/unnamed-chunk-15-1.png" alt=""><!-- --></p>
<p>hmmm. The brains are still teeny-tiny! That&rsquo;s becasue the plotting area between <code>-Inf</code>  and 0 is a constant, and is determined by ggplot to make it pretty. Thankfully, all we need to do is to make the y-limits go into the negative values to increase the image size. Because ymin of the images are bound to <code>-Inf</code> their bottom will follow the scale of the plot!</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">PLOT</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">theme</span><span class="p">(</span><span class="n">axis.text.x</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="m">60</span><span class="p">,</span> <span class="n">vjust</span><span class="o">=</span><span class="m">-.001</span><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-10</span><span class="p">,</span><span class="m">100</span><span class="p">))</span>
</span></span></code></pre></div><p><img src="index_files/figure-html/unnamed-chunk-16-1.png" alt=""><!-- --></p>
<p>That&rsquo;s how I add images to my plots! In a later post, I hope to introduce you to adding images to other types of plots, like circle plots and networks.</p>
<p>And if you have suggestions for improvement of this procedure, don&rsquo;t hesitate to let me know!</p>


    
    <h3>Citation</h3>
    <div class="columns">
      <div class="column is-half">
        For attribution, please cite this work as
        <div class="highlight" style="border: 1px solid grey">
          <p style="padding: 1em;font-family: 'monospace">
            DrMowinckels (May 7, 2018) Adding external images to plots. Retrieved from https://drmowinckels.io/blog/2018/adding-external-images-to-plots/
          </p>
        </div>
      </div>
      <div class="column is-half">
        <b>BibTeX citation</b>
        <div class="highlight" style="border: 1px solid grey">
          <p style="padding: 1em;font-family: 'monospace">
            @misc{ 2018-adding-external-images-to-plots,<br>
            &emsp;author = { DrMowinckels },<br>
            &emsp;title = { Adding external images to plots },<br>
            &emsp;url = { https://drmowinckels.io/blog/2018/adding-external-images-to-plots/ },<br>
            &emsp;year = { 2018 }<br>
            &emsp;updated = { Nov 7, 2023 }<br>
            }
          </p>
        </div>
      </div>
    </div>
  

</div>


<div class="container giscus my-4">
    <script src="https://giscus.app/client.js"
        data-repo=DrMowinckels/DrMowinckels
        data-repo-id=MDEwOlJlcG9zaXRvcnkxMjM0NzEwMTI&#61;
        data-category=Comments
        data-category-id=DIC_kwDOB1wEpM4CAG0c
        data-mapping=pathname
        data-reactions-enabled=1
        data-emit-metadata=0
        data-theme=light
        data-lang=en
        crossorigin="anonymous"
        async>
    </script>
</div>



                
                <div class="container">
    <hr>
</div>
<div class="container has-text-centered top-pad">
    <a href="#top">
        <i class="fa fa-arrow-up"></i>
    </a>
</div>

<div class="container">
    <hr>
</div>

                <div class="section" id="footer">
    <div class="container has-text-centered">
    
        <span class="footer-text">
            Athanasia Monika Mowinckel <i class="fab fa-creative-commons" aria-hidden="true"></i>-<i class="fab fa-creative-commons-by"></i>-<i class="fab fa-creative-commons-sa"></i>-2020. Feeding to <a href="https://rweekly.org'">R weekly</a>. View source code on <a href="https://github.com/Athanasiamo/DrMowinckels"><i class="fab fa-github"></i></a>.
        </span>
    
    </div>
</div>

                
            </div>
        </section>
        
        


<script src="https://drmowinckels.io/js/bundle.5c23c0437f001a469ca373a465a6f7487203d18e10cdff76d86a60af66d5ee28.js" integrity="sha256-XCPAQ38AGkaco3OkZab3SHID0Y4Qzf922Gpgr2bV7ig=" crossorigin="anonymous">></script>




<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-115545202-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>








  <script defer data-domain=drmowinckels.io src="https://plausible.io/js/plausible.js"></script>






        
        
        
        
    </body>
</html>
