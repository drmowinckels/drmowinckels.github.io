<!DOCTYPE html>
<html lang="en">
    <head>
        
            <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">

<title>
Rmarkdown Child Templates - Dr. Mowinckel&rsquo;s
</title>



            <meta property="og:title" content="Rmarkdown Child Templates - Dr. Mowinckel&rsquo;s" />
<meta property="og:type" content="website" />
<meta property="og:description" content=""/>
<meta property="og:url" content="https://drmowinckels.io/blog/2021/12-17-rmarkdown-child-templates/"/>
<meta property="og:site_name" content="Dr. Mowinckel&rsquo;s"/>



<meta property="og:image" content="https://drmowinckels.io/blog/2021/12-17-rmarkdown-child-templates/create_rmd.png"/>

<meta property="og:image" content="https://drmowinckels.io/blog/2021/12-17-rmarkdown-child-templates/index_files/figure-html/unnamed-chunk-2-1.png"/>

<meta property="og:image" content="https://drmowinckels.io/blog/2021/12-17-rmarkdown-child-templates/index_files/figure-html/unnamed-chunk-4-1.png"/>

<meta property="og:image" content="https://drmowinckels.io/blog/2021/12-17-rmarkdown-child-templates/main_pdf.png"/>

<meta property="og:image" content="https://drmowinckels.io/blog/2021/12-17-rmarkdown-child-templates/parent-and-child-md.png"/>



            
<link rel="shortcut icon" href="https://drmowinckels.io/img/fav.ico.png">


            


  
  
  
  <link rel="stylesheet" href="https://drmowinckels.io/css/main.min.8235b6920080e0a7f838f3272dcefed35808d4bd218e9f51f867612e95cab156.css" integrity="sha256-gjW2kgCA4Kf4OPMnLc7&#43;01gI1L0hjp9R&#43;GdhLpXKsVY=" crossorigin="anonymous" media="screen">




    <link rel="stylesheet" href="https://drmowinckels.io/css/syntax.css" integrity="" crossorigin="anonymous" media="screen">
    <link rel="stylesheet" href="https://drmowinckels.io/css/custom-style.css" integrity="" crossorigin="anonymous" media="screen">
        
        
        
        
    </head>
    <body> 
        <section id="top" class="section">
            
            <div class="container hero  fade-in one " style="background-image: url(/img/logo_large.svg);">
                
                

<h1 class="bold-title is-1">Blog</h1>


            </div>
            
            <div class="section  fade-in two ">
                
<div class="container">
    <hr>
    <nav class="navbar" role="navigation" aria-label="main navigation">
        
        <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false" >
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
        <div class="navbar-menu " id="navMenu">
            
            
                
                    
                        <a class="navbar-item" href="https://drmowinckels.io/">
                            
                            Home
                            
                        </a>
                    
                
                    
                        <a class="navbar-item" href="https://drmowinckels.io/about">
                            
                            About
                            
                        </a>
                    
                
                    
                        <a class="navbar-item" href="https://drmowinckels.io/#blog">
                            
                            Blog
                            
                        </a>
                    
                
                    
                        <a class="navbar-item" href="https://drmowinckels.io/#contact">
                            
                            Contact
                            
                        </a>
                    
                
            
        </div>
    </nav>
    <hr>
</div>



                
<div class="container">
    <h2 class="title is-1 top-pad strong-post-title">
        <a href="https://drmowinckels.io/blog/2021/12-17-rmarkdown-child-templates/">Rmarkdown Child Templates</a>
    </h2>
    <div class="post-data">
        Dec 17, 2021 |
        7 minutes read
    </div>
    
    
      
    
      
    
      
      
     <p>
         Categories:
          
        </p>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
      
     <p>
         Tags:
          
           <a href="https://drmowinckels.io/tags/knitr">
             knitr</a>,
         
           <a href="https://drmowinckels.io/tags/rmarkdown">
             rmarkdown</a>
         
        </p>
      
    
      
    

    
</div>

<div class="container markdown top-pad">
    <hr>

<h2 id="output-pdf_document" class="anchor-link"><a href="#output-pdf_document">title: &ldquo;main document&rdquo;
output: pdf_document</a></h2>
<hr>
<p>output: pdf_document
slug: &ldquo;rmarkdown-child-templates&rdquo;
aliases:</p>
<ul>
<li>&lsquo;/blog/2021-12-17-rmarkdown-child-templates&rsquo;</li>
</ul>
<hr>
<p>I have recently been working on a set of analyses from a survey at work.
This has been really fun, but also a little tedious.
The survey has two basic type of questions, likert-scale questions and binary yes/no questions.
For each of these two types of questions, I’ve needed to generate a set of descriptive plots and tables, as well as run a particular set of statistical models.</p>
<p>I was doing <em>a lot</em> of copy and paste of code, with whole code chunks and text for each of the questions, then doing simple search and replace of data and strings.
Tedious.</p>
<p>I know how to make Rmarkdown parametrised reports, and I kind of wanted something similar, but in a nested fashion.
Ideally, I wanted a type of Rmarkdown parametrised report I could provide data, titles and small text snippets to to generate a whole set of descriptives and statistics for me for the various questions.
But I could not find any of the sort.</p>
<p>As I often do, I went to the #Rstats twitter Gods for help.</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Rmd wishlist: a parametrized sub-section. <br><br>A way to input whole sections (text and chunks) with some parameters. I have q&#39;s following two basic logics, and thus two sets of text+chunk based on these. I&#39;d love to not copy+paste + edit all these sections, just input as sub-report</p>&mdash; Athanasia Mo Mowinckel @Drmowinckels@fosstodon.org (@DrMowinckels) <a href="https://twitter.com/DrMowinckels/status/1447518834005532676?ref_src=twsrc%5Etfw">October 11, 2021</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>And this was not at all a super easy thing to do, it turns out!
We had some nice conversations and people offered awesome advice.
#Rstats twitter really is the best!</p>
<p>In the end, I opted for a solution that looked really awesome, and I currently cannot find the tweet that pointed me in that direction (if anyone finds it, let me know so I can attribute properly!)</p>
<p>Let’s make some files to test!</p>

<h2 id="create-the-rmd" class="anchor-link"><a href="#create-the-rmd">Create the Rmd</a></h2>
<p>First off, we will make an Rmd file, by going to File -&gt; New file -&gt; Rmarkdown … in RStudio, then choose to create a PDF.</p>
<p><img src="create_rmd.png" alt="Image of the RStudio UI showing how to create a new Rmarkdown file"></p>
<p><img src="main_pdf.png" alt="Image of the RStudio UI showing how to create a new Rmarkdown file"></p>
<p>Now we have a main document to create from. This is the document where we will call on other rmarkdown templates to be added.</p>
<p>I deleted everything in the <a href="https://github.com/Athanasiamo/DrMowinckels/tree/master/content/blog/2021-12-17-rmarkdown-child-templates/main-document.Rmd">main document</a> (we could have just created an empty one in the step before also).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-md" data-lang="md"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">```{r setup, include=FALSE}
</span></span><span class="line"><span class="cl">knitr::opts_chunk$set(echo = TRUE)
</span></span><span class="line"><span class="cl">```
</span></span></code></pre></div><p>SO we have a document now, that will knit to pdf, and where code chunk code will be rendered in the document.</p>
<p>Let us make some stuff to plot.
We’ll use the palmerpenguins package and dataset, and make a plot of penguins bill length against bill depth, and a summary table of the mean, min and maximum values of these two measures.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
</span></span></code></pre></div><pre><code>## 
## Attaching package: 'dplyr'

## The following objects are masked from 'package:stats':
## 
##     filter, lag

## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">palmerpenguins</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">penguins</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">bill_length_mm</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">bill_depth_mm</span><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_point</span><span class="p">()</span>
</span></span></code></pre></div><pre><code>## Warning: Removed 2 rows containing missing values (geom_point).
</code></pre>
<img src="https://drmowinckels.io/blog/2021/12-17-rmarkdown-child-templates/index_files/figure-html/unnamed-chunk-2-1.png" width="672" />
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">penguins</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">pivot_longer</span><span class="p">(</span><span class="nf">ends_with</span><span class="p">(</span><span class="s">&#34;mm&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">               <span class="n">names_to</span> <span class="o">=</span> <span class="s">&#34;cols&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">               <span class="n">values_to</span> <span class="o">=</span> <span class="s">&#34;mm&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">               <span class="n">values_drop_na</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">group_by</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">summarise</span><span class="p">(</span><span class="nf">across</span><span class="p">(</span><span class="n">mm</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                   <span class="n">.fns</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">mean</span> <span class="o">=</span> <span class="n">mean</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                               <span class="n">min</span> <span class="o">=</span> <span class="n">min</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                               <span class="n">max</span> <span class="o">=</span> <span class="n">max</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                               <span class="n">N</span> <span class="o">=</span> <span class="n">length</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                    <span class="n">.names</span> <span class="o">=</span> <span class="s">&#34;{.fn}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span></code></pre></div><pre><code>## # A tibble: 3 × 5
##   cols               mean   min   max     N
##   &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
## 1 bill_depth_mm      17.2  13.1  21.5   342
## 2 bill_length_mm     43.9  32.1  59.6   342
## 3 flipper_length_mm 201.  172   231     342
</code></pre>
<p>We did quite a lot here, and I for once don’t intend on digging into the details of what I did.
You can read lots about <a href="https://tidyr.tidyverse.org/articles/pivot.html#longer-2">pivoting</a> on the tidyverse pages.</p>
<p>ok. SO we now have an overall plot and table for all the penguins.
But say I want to have one section for each of the three penguins species.
And lets forget about grouping data and making colours in the plots to easily see the species.
We want, one chapter per penguin species.</p>
<p>How do we do that?</p>
<p>We could copy and paste the code, with filters to only grab the species we want.
But we’d have to do that three times, and if we wanted to change something, we’d have to change it in all three places.
Things could easily get very cumbersome.</p>
<p>We can make a so-called “child”-document, and provide it with what it needed to create what we wanted.
The child document will be another Rmd, that will depend on certain things existing in its <code>enviroment</code> to run.
Since <a href="https://github.com/yihui/knitr/issues/1884">child documents cannot be parametrised</a> this was in my opinion the smoothest solution.</p>

<h2 id="making-the-child-document" class="anchor-link"><a href="#making-the-child-document">Making the child document</a></h2>
<p>Create a new Rmarkdown file like before, and name it something meaningful.
I’ll call it <a href="https://github.com/Athanasiamo/DrMowinckels/tree/master/content/blog/2021-12-17-rmarkdown-child-templates/species-child.Rmd"><code>species-child.Rmd</code></a>, in this case, choose the “Create empty document” in the RStudio UI.</p>
<p>This document will not have any other yaml than the type of output is should contain.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-md" data-lang="md"></code></pre></div><p>Then we can copy in our plot and table code, so that we can build on that.
I’ll choose the simplest way I can think of to do this, and that is by having a single object in the environment of the child document that will let our code know which species it should base it self on.
We’ll call the object <code>species</code>, and have a piece of code in our child document that creates an object called <code>data</code> which only contains that species from the penguins data set.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-md" data-lang="md"><span class="line"><span class="cl"><span class="gu">## Species `r species`
</span></span></span><span class="line"><span class="cl"><span class="gu"></span>
</span></span><span class="line"><span class="cl">```{r setup, include=FALSE}
</span></span><span class="line"><span class="cl">knitr::opts_chunk$set(echo = TRUE)
</span></span><span class="line"><span class="cl">library(ggplot2)
</span></span><span class="line"><span class="cl">library(dplyr)
</span></span><span class="line"><span class="cl">library(palmerpenguins)
</span></span><span class="line"><span class="cl">library(tidyr)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gh"># Filter the penguins data by species
</span></span></span><span class="line"><span class="cl"><span class="gh"></span>data <span class="p">&lt;</span><span class="nt">-</span> <span class="na">filter</span><span class="err">(</span><span class="na">penguins</span><span class="err">,</span> <span class="na">species </span><span class="o">=</span><span class="s">=</span> <span class="na">species</span><span class="err">)</span>
</span></span><span class="line"><span class="cl"><span class="s">```
</span></span></span><span class="line"><span class="cl"><span class="s"></span>
</span></span><span class="line"><span class="cl">```{r}
</span></span><span class="line"><span class="cl">data %&gt;% 
</span></span><span class="line"><span class="cl">  ggplot(aes(x = bill_length_mm, y = bill_depth_mm)) +
</span></span><span class="line"><span class="cl">  geom_point()
</span></span><span class="line"><span class="cl"><span class="s">```</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">```{</span><span class="na">r</span><span class="err">}</span>
</span></span><span class="line"><span class="cl"><span class="na">data</span> <span class="err">%</span><span class="p">&gt;</span>% 
</span></span><span class="line"><span class="cl">  pivot_longer(ends_with(&#34;mm&#34;),
</span></span><span class="line"><span class="cl">               names_to = &#34;cols&#34;,
</span></span><span class="line"><span class="cl">               values_to = &#34;mm&#34;, 
</span></span><span class="line"><span class="cl">               values_drop_na = TRUE) %&gt;% 
</span></span><span class="line"><span class="cl">  group_by(cols) %&gt;% 
</span></span><span class="line"><span class="cl">  summarise(across(mm, 
</span></span><span class="line"><span class="cl">                   .fns = list(mean = mean, 
</span></span><span class="line"><span class="cl">                               min = min, 
</span></span><span class="line"><span class="cl">                               max = max,
</span></span><span class="line"><span class="cl">                               N = length),
</span></span><span class="line"><span class="cl">                    .names = &#34;{.fn}&#34;)
</span></span><span class="line"><span class="cl">  )
</span></span><span class="line"><span class="cl">```
</span></span></code></pre></div><p>Ok, so out child doc is ready.
How do we call it from the main document (parent) and how to we give it the species variable if we cannot give it parameters?</p>

<h2 id="knitr-child-document" class="anchor-link"><a href="#knitr-child-document">Knitr child document</a></h2>
<p>The knitr package has a particular function to knit child documents, and you can <a href="https://bookdown.org/yihui/rmarkdown-cookbook/child-document.html">read more about it in the Rmarkdown cookbook</a>.
We are going to do something not particularly highlighted there, and use an option in that function were you provide an R environment to the child document.
Child documents, just like all Rmarkdown documents, are knit in clean environments, making them awesome reproducible documents, they won’t render if you rely on things existing in your environment that is not generated by code.
By using the <code>envir</code> option in the function, we can provide the species designation to the child document, so that it renders only the species we ask for!</p>
<p>In your main document, add the below code, which creates a new environment, adds an object <code>species</code> with the string “Adelie” in it, knits the child document and saves the output to an object in the main document, an then prints the output into the main document.</p>
<p><strong>NOTE</strong> notice how the code chunk in the main document has <code>results = 'asis'</code> specified. This is important. Knitr will create the markdown needed to create the pdf, so the output of the code chunk is actually markdown that we want to be knitted to latex then pdf.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-md" data-lang="md"><span class="line"><span class="cl">```{r, results = &#39;asis&#39;}
</span></span><span class="line"><span class="cl"><span class="gh"># Define new environment
</span></span></span><span class="line"><span class="cl"><span class="gh"></span>child_env <span class="p">&lt;</span><span class="nt">-</span> <span class="na">new</span><span class="err">.</span><span class="na">env</span><span class="err">()</span>
</span></span><span class="line"><span class="cl"><span class="na">child_env</span><span class="err">$</span><span class="na">species</span> <span class="err">&lt;</span><span class="na">-</span> <span class="err">&#34;</span><span class="na">Adelie</span><span class="err">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gh"># knit the document and save the character output to an object
</span></span></span><span class="line"><span class="cl"><span class="gh"></span><span class="na">res</span> <span class="err">&lt;</span><span class="na">-</span> <span class="na">knitr::knit_child</span><span class="err">(</span>
</span></span><span class="line"><span class="cl">  <span class="err">&#34;</span><span class="na">species-child</span><span class="err">.</span><span class="na">Rmd</span><span class="err">&#34;,</span>
</span></span><span class="line"><span class="cl">  <span class="na">envir </span><span class="o">=</span> <span class="s">child_env,</span>
</span></span><span class="line"><span class="cl">  <span class="na">quiet </span><span class="o">=</span> <span class="s">TRUE</span>
</span></span><span class="line"><span class="cl"><span class="err">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gh"># Cat the object to make it render in your main document
</span></span></span><span class="line"><span class="cl"><span class="gh"></span><span class="na">cat</span><span class="err">(</span><span class="na">res</span><span class="err">,</span> <span class="na">sep </span><span class="o">=</span> <span class="s">&#39;</span>\n<span class="s">&#39;</span><span class="err">)</span>
</span></span><span class="line"><span class="cl"><span class="err">```</span>
</span></span></code></pre></div><p>Now, we can copy and paste that code chunk for all three species, and have a neat little report made.
You can have a look at the documents in the github repo of this post, and hopefully it will make some sense.</p>
<ul>
<li><a href="https://github.com/Athanasiamo/DrMowinckels/tree/master/content/blog/2021-12-17-rmarkdown-child-templates/main-document.Rmd">Main document</a></li>
<li><a href="https://github.com/Athanasiamo/DrMowinckels/tree/master/content/blog/2021-12-17-rmarkdown-child-templates/species-child.Rmd">Child document</a></li>
</ul>


    
    <h3>Citation</h3>
    <div class="columns">
      <div class="column is-half">
        For attribution, please cite this work as
        <div class="highlight" style="border: 1px solid grey">
          <p style="padding: 1em;font-family: 'monospace">
            Athanasia M. Mowinckel (Dec 17, 2021) Rmarkdown Child Templates. Retrieved from https://drmowinckels.io/blog/2021/12-17-rmarkdown-child-templates/
          </p>
        </div>
      </div>
      <div class="column is-half">
        <b>BibTeX citation</b>
        <div class="highlight" style="border: 1px solid grey">
          <p style="padding: 1em;font-family: 'monospace">
            @misc{ 2021-rmarkdown-child-templates,<br>
            &emsp;author = { Athanasia M. Mowinckel },<br>
            &emsp;title = { Rmarkdown Child Templates },<br>
            &emsp;url = { https://drmowinckels.io/blog/2021/12-17-rmarkdown-child-templates/ },<br>
            &emsp;year = { 2021 }<br>
            &emsp;updated = { Nov 4, 2023 }<br>
            }
          </p>
        </div>
      </div>
    </div>
  

</div>


<div class="container giscus my-4">
    <script src="https://giscus.app/client.js"
        data-repo=DrMowinckels/DrMowinckels
        data-repo-id=MDEwOlJlcG9zaXRvcnkxMjM0NzEwMTI&#61;
        data-category=Comments
        data-category-id=DIC_kwDOB1wEpM4CAG0c
        data-mapping=pathname
        data-reactions-enabled=1
        data-emit-metadata=0
        data-theme=light
        data-lang=en
        crossorigin="anonymous"
        async>
    </script>
</div>



                
                <div class="container">
    <hr>
</div>
<div class="container has-text-centered top-pad">
    <a href="#top">
        <i class="fa fa-arrow-up"></i>
    </a>
</div>

<div class="container">
    <hr>
</div>

                <div class="section" id="footer">
    <div class="container has-text-centered">
    
        <span class="footer-text">
            Athanasia Monika Mowinckel <i class="fab fa-creative-commons" aria-hidden="true"></i>-<i class="fab fa-creative-commons-by"></i>-<i class="fab fa-creative-commons-sa"></i>-2020. Feeding to <a href="https://rweekly.org'">R weekly</a>. View source code on <a href="https://github.com/Athanasiamo/DrMowinckels"><i class="fab fa-github"></i></a>.
        </span>
    
    </div>
</div>

                
            </div>
        </section>
        
        


<script src="https://drmowinckels.io/js/bundle.5c23c0437f001a469ca373a465a6f7487203d18e10cdff76d86a60af66d5ee28.js" integrity="sha256-XCPAQ38AGkaco3OkZab3SHID0Y4Qzf922Gpgr2bV7ig=" crossorigin="anonymous">></script>




<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-115545202-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>








  <script defer data-domain=drmowinckels.io src="https://plausible.io/js/plausible.js"></script>






        
        
        
        
    </body>
</html>
